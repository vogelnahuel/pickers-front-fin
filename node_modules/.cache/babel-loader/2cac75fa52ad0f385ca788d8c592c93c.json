{"ast":null,"code":"import createCSV from \".,/../../src/utils/createCSV\";\nimport { goBack } from \"connected-react-router\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { actions } from \"reducers/pickers\";\nimport { call, put, takeLatest } from \"redux-saga/effects\";\nimport { DATE_FORMATS } from \"utils/constants\";\nimport * as pickersMiddleware from \"../middleware/pickers\";\nimport { actions as detailPickerActions } from \"../reducers/detailPicker\";\nimport { actions as notificationActions } from \"../reducers/notification\";\nconst sagas = [takeLatest(actions.getPendingUserRequest.type, getPickers), takeLatest(actions.getPendingUserExportRequest.type, getPendingUserExport), takeLatest(actions.getMorePendingUserRequest.type, getMorePendingUser), takeLatest(detailPickerActions.getPendingUserPickerRequest.type, getPendingUserPicker), takeLatest(detailPickerActions.getPendingUserPickerExportRequest.type, getPendingUserPickerExport), takeLatest(detailPickerActions.getPendingUserPickerDocumentsEditRequest.type, postPendingUserDocumentsEdit), takeLatest(detailPickerActions.getAprovePickerRequest.type, postAprovePicker), takeLatest(detailPickerActions.getEditPickerRequest.type, postEditPicker), takeLatest(detailPickerActions.getPickerFileRequest.type, getPickerFile), takeLatest(detailPickerActions.getPickerFileSaveRequest.type, putFileUpload), takeLatest(detailPickerActions.getPickerFileDeleteRequest.type, fileDelete)];\nexport default sagas;\n\nconst process = body => {\n  return { ...body,\n    personalData: { ...body.personalData,\n      dateOfBirth: moment(body.personalData.dateOfBirth, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate)\n    },\n    accountingData: { ...body.accountingData,\n      fiscalNumber: body.accountingData.fiscalNumber.slice(0, 2) + body.accountingData.fiscalNumber.slice(5, 13) + body.accountingData.fiscalNumber.slice(16, 17)\n    },\n    vehicle: { ...body.vehicle,\n      expirationDatePolicyVehicle: body.vehicle.expirationDatePolicyVehicle && body.vehicle.expirationDatePolicyVehicle.match(DATE_FORMATS.regexshortDate) ? moment(body.vehicle.expirationDatePolicyVehicle, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate) : body.vehicle.expirationDatePolicyVehicle,\n      expirationDateIdentificationVehicle: body.vehicle.expirationDateIdentificationVehicle && body.vehicle.expirationDateIdentificationVehicle.match(DATE_FORMATS.regexshortDate) ? moment(body.vehicle.expirationDateIdentificationVehicle, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate) : body.vehicle.expirationDateIdentificationVehicle,\n      expirationDateDriverLicense: body.vehicle.expirationDateDriverLicense && body.vehicle.expirationDateDriverLicense.match(DATE_FORMATS.regexshortDate) ? moment(body.vehicle.expirationDateDriverLicense, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate) : body.vehicle.expirationDateDriverLicense\n    }\n  };\n};\n\nfunction* getPickers(_ref) {\n  let {\n    payload\n  } = _ref;\n  const response = yield call(pickersMiddleware.getPickers, payload);\n\n  if (response.status !== 200) {\n    yield put(actions.getPendingUserError());\n  } else {\n    const {\n      result: {\n        items\n      },\n      ...rest\n    } = response.data;\n    yield put(actions.getPendingUserSuccess({\n      items,\n      ...rest\n    }));\n  }\n}\n\nfunction* getMorePendingUser(_ref2) {\n  let {\n    payload\n  } = _ref2;\n  const response = yield call(pickersMiddleware.getPickers, payload);\n\n  if (response.status !== 200) {\n    yield put(actions.getPendingUserError());\n  } else {\n    const {\n      result: {\n        items\n      },\n      ...rest\n    } = response.data;\n    yield put(actions.getMorePendingUserSuccess({\n      items,\n      ...rest\n    }));\n  }\n}\n\nfunction* getPendingUserPicker(_ref3) {\n  let {\n    payload\n  } = _ref3;\n  const response = yield call(pickersMiddleware.getPicker, payload);\n\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPendingUserPickerError());\n  } else {\n    const {\n      result\n    } = response.data;\n    yield put(detailPickerActions.getPendingUserPickerSuccess(result));\n    yield put(actions.setActualPage(result.status.id === 4 || result.status.id === 5 ? \"ACTIVE\" : \"PENDING\"));\n  }\n}\n\nfunction* getPendingUserExport(_ref4) {\n  let {\n    payload\n  } = _ref4;\n  const response = yield call(pickersMiddleware.getPickersExport, payload);\n\n  if (response.status !== 200) {\n    yield put(actions.getPendingUserExportError());\n  } else {\n    createCSV(response.data, \"pickers\");\n    yield put(actions.getPendingUserExportSuccess());\n    yield put(notificationActions.showNotification({\n      level: \"success\",\n      title: i18next.t(\"global:title.modal.export\"),\n      body: i18next.t(\"global:label.modal.export\")\n    }));\n  }\n}\n\nfunction* getPendingUserPickerExport(_ref5) {\n  let {\n    payload: {\n      email\n    }\n  } = _ref5;\n  const response = yield call(pickersMiddleware.getPickerExport, {\n    email\n  });\n\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPendingUserPickerExportError());\n  } else {\n    createCSV(response.data, \"pickers\");\n    yield put(notificationActions.showNotification({\n      level: \"success\",\n      title: i18next.t(\"global:title.modal.export\"),\n      body: i18next.t(\"global:label.modal.export\")\n    }));\n    yield put(detailPickerActions.getPendingUserPickerExportSuccess());\n  }\n}\n\nfunction* postPendingUserDocumentsEdit(_ref6) {\n  let {\n    payload\n  } = _ref6;\n  let body = process(payload);\n  const response = yield call(pickersMiddleware.postPickerDocumentsEdit, body);\n\n  if (response.status !== 200) {\n    yield put(notificationActions.showNotification({\n      level: \"error\",\n      title: i18next.t(\"global:title.modal.connectionError\"),\n      body: i18next.t(\"global:label.modal.connectionError\")\n    }));\n    yield put(detailPickerActions.getPendingUserPickerDocumentsEditError());\n  } else {\n    yield put(goBack());\n    yield put(detailPickerActions.getPendingUserPickerDocumentsEditSuccess(body));\n  }\n}\n\nfunction* postAprovePicker(_ref7) {\n  let {\n    payload: {\n      params,\n      goBack\n    }\n  } = _ref7;\n  let body = process(params);\n  const response = yield call(pickersMiddleware.postAprovePicker, body);\n\n  if (response.status !== 200) {\n    yield put(notificationActions.showNotification({\n      level: \"error\",\n      title: i18next.t(\"global:title.modal.connectionError\"),\n      body: i18next.t(\"global:label.modal.connectionError\")\n    }));\n    yield put(detailPickerActions.getAprovePickerError());\n  } else {\n    yield put(notificationActions.showNotification({\n      level: \"success\",\n      title: i18next.t(\"detailPicker:title.modal.approved\"),\n      body: i18next.t(\"detailPicker:label.modal.approved\"),\n      onClick: goBack\n    }));\n    yield put(detailPickerActions.getAprovePickerSuccess(body));\n  }\n}\n\nfunction* postEditPicker(_ref8) {\n  let {\n    payload: {\n      params,\n      goBack\n    }\n  } = _ref8;\n  let body = process(params);\n  const response = yield call(pickersMiddleware.postEditPicker, body);\n\n  if (response.status !== 200) {\n    yield put(notificationActions.showNotification({\n      level: \"error\",\n      title: i18next.t(\"global:title.modal.connectionError\"),\n      body: i18next.t(\"global:label.modal.connectionError\")\n    }));\n    yield put(detailPickerActions.getEditPickerError());\n  } else {\n    yield put(notificationActions.showNotification({\n      level: \"success\",\n      title: i18next.t(\"global:title.modal.changesSaved\"),\n      body: i18next.t(\"global:label.modal.changesSaved\"),\n      onClick: goBack\n    }));\n    yield put(detailPickerActions.getEditPickerSuccess(body));\n  }\n}\n\nfunction* getPickerFile(_ref9) {\n  let {\n    payload\n  } = _ref9;\n  const response = yield call(pickersMiddleware.getFile, payload);\n\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPickerFileError());\n  } else {\n    const {\n      result\n    } = response.data;\n    if (result.url) window.open(result.url, \"_blank\");\n    yield put(detailPickerActions.getPickerFileSuccess());\n  }\n}\n\nfunction* fileDelete(_ref10) {\n  let {\n    payload: {\n      id,\n      tag\n    }\n  } = _ref10;\n  const response = yield call(pickersMiddleware.deleteFile, id, tag);\n\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPickerFileDeleteError({\n      tag\n    }));\n  } else {\n    yield put(detailPickerActions.getPickerFileDeleteSuccess({\n      tag\n    }));\n    yield put(detailPickerActions.getPendingUserPickerRequest(id));\n  }\n}\n\nfunction* putFileUpload(_ref11) {\n  let {\n    payload: {\n      id,\n      content,\n      tag\n    }\n  } = _ref11;\n  const response = yield call(pickersMiddleware.fileUpload, id, {\n    content: content,\n    tag: tag\n  });\n\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPickerFileSaveError({\n      tag\n    }));\n  } else {\n    yield put(detailPickerActions.getPickerFileSaveSuccess({\n      tag\n    }));\n    yield put(detailPickerActions.getPendingUserPickerRequest(id));\n  }\n}","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/sagas/pickers.ts"],"names":["createCSV","goBack","i18next","moment","actions","call","put","takeLatest","DATE_FORMATS","pickersMiddleware","detailPickerActions","notificationActions","sagas","getPendingUserRequest","type","getPickers","getPendingUserExportRequest","getPendingUserExport","getMorePendingUserRequest","getMorePendingUser","getPendingUserPickerRequest","getPendingUserPicker","getPendingUserPickerExportRequest","getPendingUserPickerExport","getPendingUserPickerDocumentsEditRequest","postPendingUserDocumentsEdit","getAprovePickerRequest","postAprovePicker","getEditPickerRequest","postEditPicker","getPickerFileRequest","getPickerFile","getPickerFileSaveRequest","putFileUpload","getPickerFileDeleteRequest","fileDelete","process","body","personalData","dateOfBirth","shortDate","format","shortISODate","accountingData","fiscalNumber","slice","vehicle","expirationDatePolicyVehicle","match","regexshortDate","expirationDateIdentificationVehicle","expirationDateDriverLicense","payload","response","status","getPendingUserError","result","items","rest","data","getPendingUserSuccess","getMorePendingUserSuccess","getPicker","getPendingUserPickerError","getPendingUserPickerSuccess","setActualPage","id","getPickersExport","getPendingUserExportError","getPendingUserExportSuccess","showNotification","level","title","t","email","getPickerExport","getPendingUserPickerExportError","getPendingUserPickerExportSuccess","postPickerDocumentsEdit","getPendingUserPickerDocumentsEditError","getPendingUserPickerDocumentsEditSuccess","params","getAprovePickerError","onClick","getAprovePickerSuccess","getEditPickerError","getEditPickerSuccess","getFile","getPickerFileError","url","window","open","getPickerFileSuccess","tag","deleteFile","getPickerFileDeleteError","getPickerFileDeleteSuccess","content","fileUpload","getPickerFileSaveError","getPickerFileSaveSuccess"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,8BAAtB;AAIA,SAASC,MAAT,QAAuB,wBAAvB;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,SAASC,OAAT,QAAwB,kBAAxB;AAEA,SACEC,IADF,EAGEC,GAHF,EAKEC,UALF,QAMO,oBANP;AAOA,SAASC,YAAT,QAA6B,iBAA7B;AACA,OAAO,KAAKC,iBAAZ,MAAmC,uBAAnC;AAgBA,SAASL,OAAO,IAAIM,mBAApB,QAA+C,0BAA/C;AACA,SAASN,OAAO,IAAIO,mBAApB,QAA+C,0BAA/C;AAOA,MAAMC,KAAK,GAAG,CACZL,UAAU,CAACH,OAAO,CAACS,qBAAR,CAA8BC,IAA/B,EAAqCC,UAArC,CADE,EAEZR,UAAU,CAACH,OAAO,CAACY,2BAAR,CAAoCF,IAArC,EAA2CG,oBAA3C,CAFE,EAGZV,UAAU,CAACH,OAAO,CAACc,yBAAR,CAAkCJ,IAAnC,EAAyCK,kBAAzC,CAHE,EAIZZ,UAAU,CACRG,mBAAmB,CAACU,2BAApB,CAAgDN,IADxC,EAERO,oBAFQ,CAJE,EAQZd,UAAU,CACRG,mBAAmB,CAACY,iCAApB,CAAsDR,IAD9C,EAERS,0BAFQ,CARE,EAYZhB,UAAU,CACRG,mBAAmB,CAACc,wCAApB,CAA6DV,IADrD,EAERW,4BAFQ,CAZE,EAgBZlB,UAAU,CAACG,mBAAmB,CAACgB,sBAApB,CAA2CZ,IAA5C,EAAkDa,gBAAlD,CAhBE,EAiBZpB,UAAU,CAACG,mBAAmB,CAACkB,oBAApB,CAAyCd,IAA1C,EAAgDe,cAAhD,CAjBE,EAkBZtB,UAAU,CAACG,mBAAmB,CAACoB,oBAApB,CAAyChB,IAA1C,EAAgDiB,aAAhD,CAlBE,EAmBZxB,UAAU,CAACG,mBAAmB,CAACsB,wBAApB,CAA6ClB,IAA9C,EAAoDmB,aAApD,CAnBE,EAoBZ1B,UAAU,CAACG,mBAAmB,CAACwB,0BAApB,CAA+CpB,IAAhD,EAAsDqB,UAAtD,CApBE,CAAd;AAuBA,eAAevB,KAAf;;AAEA,MAAMwB,OAAO,GAAIC,IAAD,IASV;AACJ,SAAO,EACL,GAAGA,IADE;AAGLC,IAAAA,YAAY,EAAE,EACZ,GAAGD,IAAI,CAACC,YADI;AAEZC,MAAAA,WAAW,EAAEpC,MAAM,CACjBkC,IAAI,CAACC,YAAL,CAAkBC,WADD,EAEjB/B,YAAY,CAACgC,SAFI,CAAN,CAGXC,MAHW,CAGJjC,YAAY,CAACkC,YAHT;AAFD,KAHT;AAULC,IAAAA,cAAc,EAAE,EACd,GAAGN,IAAI,CAACM,cADM;AAEdC,MAAAA,YAAY,EACVP,IAAI,CAACM,cAAL,CAAoBC,YAApB,CAAiCC,KAAjC,CAAuC,CAAvC,EAA0C,CAA1C,IACAR,IAAI,CAACM,cAAL,CAAoBC,YAApB,CAAiCC,KAAjC,CAAuC,CAAvC,EAA0C,EAA1C,CADA,GAEAR,IAAI,CAACM,cAAL,CAAoBC,YAApB,CAAiCC,KAAjC,CAAuC,EAAvC,EAA2C,EAA3C;AALY,KAVX;AAiBLC,IAAAA,OAAO,EAAE,EACP,GAAGT,IAAI,CAACS,OADD;AAGPC,MAAAA,2BAA2B,EACzBV,IAAI,CAACS,OAAL,CAAaC,2BAAb,IACAV,IAAI,CAACS,OAAL,CAAaC,2BAAb,CAAyCC,KAAzC,CACExC,YAAY,CAACyC,cADf,CADA,GAII9C,MAAM,CACJkC,IAAI,CAACS,OAAL,CAAaC,2BADT,EAEJvC,YAAY,CAACgC,SAFT,CAAN,CAGEC,MAHF,CAGSjC,YAAY,CAACkC,YAHtB,CAJJ,GAQIL,IAAI,CAACS,OAAL,CAAaC,2BAZZ;AAaPG,MAAAA,mCAAmC,EACjCb,IAAI,CAACS,OAAL,CAAaI,mCAAb,IACAb,IAAI,CAACS,OAAL,CAAaI,mCAAb,CAAiDF,KAAjD,CACExC,YAAY,CAACyC,cADf,CADA,GAII9C,MAAM,CACJkC,IAAI,CAACS,OAAL,CAAaI,mCADT,EAEJ1C,YAAY,CAACgC,SAFT,CAAN,CAGEC,MAHF,CAGSjC,YAAY,CAACkC,YAHtB,CAJJ,GAQIL,IAAI,CAACS,OAAL,CAAaI,mCAtBZ;AAuBPC,MAAAA,2BAA2B,EACzBd,IAAI,CAACS,OAAL,CAAaK,2BAAb,IACAd,IAAI,CAACS,OAAL,CAAaK,2BAAb,CAAyCH,KAAzC,CACExC,YAAY,CAACyC,cADf,CADA,GAII9C,MAAM,CACJkC,IAAI,CAACS,OAAL,CAAaK,2BADT,EAEJ3C,YAAY,CAACgC,SAFT,CAAN,CAGEC,MAHF,CAGSjC,YAAY,CAACkC,YAHtB,CAJJ,GAQIL,IAAI,CAACS,OAAL,CAAaK;AAhCZ;AAjBJ,GAAP;AAoDD,CA9DD;;AA+DA,UAAUpC,UAAV,OAQE;AAAA,MARmB;AACnBqC,IAAAA;AADmB,GAQnB;AACA,QAAMC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACM,UAAnB,EAA+BqC,OAA/B,CAA3B;;AACA,MAAIC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACF,OAAO,CAACmD,mBAAR,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AACJC,MAAAA,MAAM,EAAE;AAAEC,QAAAA;AAAF,OADJ;AAEJ,SAAGC;AAFC,QAGFL,QAAQ,CAACM,IAHb;AAIA,UAAMrD,GAAG,CAACF,OAAO,CAACwD,qBAAR,CAA8B;AAAEH,MAAAA,KAAF;AAAS,SAAGC;AAAZ,KAA9B,CAAD,CAAT;AACD;AACF;;AAED,UAAUvC,kBAAV,QAOE;AAAA,MAP2B;AAC3BiC,IAAAA;AAD2B,GAO3B;AACA,QAAMC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACM,UAAnB,EAA+BqC,OAA/B,CAA3B;;AACA,MAAIC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACF,OAAO,CAACmD,mBAAR,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AACJC,MAAAA,MAAM,EAAE;AAAEC,QAAAA;AAAF,OADJ;AAEJ,SAAGC;AAFC,QAGFL,QAAQ,CAACM,IAHb;AAIA,UAAMrD,GAAG,CAACF,OAAO,CAACyD,yBAAR,CAAkC;AAAEJ,MAAAA,KAAF;AAAS,SAAGC;AAAZ,KAAlC,CAAD,CAAT;AACD;AACF;;AAED,UAAUrC,oBAAV,QAME;AAAA,MAN6B;AAC7B+B,IAAAA;AAD6B,GAM7B;AACA,QAAMC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACqD,SAAnB,EAA8BV,OAA9B,CAA3B;;AACA,MAAIC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACI,mBAAmB,CAACqD,yBAApB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AAAEP,MAAAA;AAAF,QAAaH,QAAQ,CAACM,IAA5B;AACA,UAAMrD,GAAG,CAACI,mBAAmB,CAACsD,2BAApB,CAAgDR,MAAhD,CAAD,CAAT;AACA,UAAMlD,GAAG,CACPF,OAAO,CAAC6D,aAAR,CACET,MAAM,CAACF,MAAP,CAAcY,EAAd,KAAqB,CAArB,IAA0BV,MAAM,CAACF,MAAP,CAAcY,EAAd,KAAqB,CAA/C,GAAmD,QAAnD,GAA8D,SADhE,CADO,CAAT;AAKD;AACF;;AAED,UAAUjD,oBAAV,QAOE;AAAA,MAP6B;AAC7BmC,IAAAA;AAD6B,GAO7B;AACA,QAAMC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAAC0D,gBAAnB,EAAqCf,OAArC,CAA3B;;AAEA,MAAIC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACF,OAAO,CAACgE,yBAAR,EAAD,CAAT;AACD,GAFD,MAEO;AACLpE,IAAAA,SAAS,CAACqD,QAAQ,CAACM,IAAV,EAAgB,SAAhB,CAAT;AACA,UAAMrD,GAAG,CAACF,OAAO,CAACiE,2BAAR,EAAD,CAAT;AACA,UAAM/D,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,SAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,2BAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,2BAAV;AAH6B,KAArC,CADO,CAAT;AAOD;AACF;;AAED,UAAUlD,0BAAV,QAOE;AAAA,MAPmC;AACnC6B,IAAAA,OAAO,EAAE;AAAEsB,MAAAA;AAAF;AAD0B,GAOnC;AACA,QAAMrB,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACkE,eAAnB,EAAoC;AAAED,IAAAA;AAAF,GAApC,CAA3B;;AACA,MAAIrB,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACI,mBAAmB,CAACkE,+BAApB,EAAD,CAAT;AACD,GAFD,MAEO;AACL5E,IAAAA,SAAS,CAACqD,QAAQ,CAACM,IAAV,EAAgB,SAAhB,CAAT;AACA,UAAMrD,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,SAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,2BAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,2BAAV;AAH6B,KAArC,CADO,CAAT;AAOA,UAAMnE,GAAG,CAACI,mBAAmB,CAACmE,iCAApB,EAAD,CAAT;AACD;AACF;;AAED,UAAUpD,4BAAV,QAQE;AAAA,MARqC;AACrC2B,IAAAA;AADqC,GAQrC;AACA,MAAIf,IAAI,GAAGD,OAAO,CAACgB,OAAD,CAAlB;AACA,QAAMC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACqE,uBAAnB,EAA4CzC,IAA5C,CAA3B;;AAEA,MAAIgB,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,OAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,oCAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,oCAAV;AAH6B,KAArC,CADO,CAAT;AAOA,UAAMnE,GAAG,CAACI,mBAAmB,CAACqE,sCAApB,EAAD,CAAT;AACD,GATD,MASO;AACL,UAAMzE,GAAG,CAACL,MAAM,EAAP,CAAT;AACA,UAAMK,GAAG,CACPI,mBAAmB,CAACsE,wCAApB,CAA6D3C,IAA7D,CADO,CAAT;AAGD;AACF;;AAED,UAAUV,gBAAV,QAQE;AAAA,MARyB;AACzByB,IAAAA,OAAO,EAAE;AAAE6B,MAAAA,MAAF;AAAUhF,MAAAA;AAAV;AADgB,GAQzB;AACA,MAAIoC,IAAI,GAAGD,OAAO,CAAC6C,MAAD,CAAlB;AACA,QAAM5B,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACkB,gBAAnB,EAAqCU,IAArC,CAA3B;;AACA,MAAIgB,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,OAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,oCAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,oCAAV;AAH6B,KAArC,CADO,CAAT;AAOA,UAAMnE,GAAG,CAACI,mBAAmB,CAACwE,oBAApB,EAAD,CAAT;AACD,GATD,MASO;AACL,UAAM5E,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,SAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,mCAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,mCAAV,CAH6B;AAInCU,MAAAA,OAAO,EAAElF;AAJ0B,KAArC,CADO,CAAT;AAQA,UAAMK,GAAG,CAACI,mBAAmB,CAAC0E,sBAApB,CAA2C/C,IAA3C,CAAD,CAAT;AACD;AACF;;AAED,UAAUR,cAAV,QAQE;AAAA,MARuB;AACvBuB,IAAAA,OAAO,EAAE;AAAE6B,MAAAA,MAAF;AAAUhF,MAAAA;AAAV;AADc,GAQvB;AACA,MAAIoC,IAAI,GAAGD,OAAO,CAAC6C,MAAD,CAAlB;AACA,QAAM5B,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACoB,cAAnB,EAAmCQ,IAAnC,CAA3B;;AACA,MAAIgB,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,OAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,oCAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,oCAAV;AAH6B,KAArC,CADO,CAAT;AAOA,UAAMnE,GAAG,CAACI,mBAAmB,CAAC2E,kBAApB,EAAD,CAAT;AACD,GATD,MASO;AACL,UAAM/E,GAAG,CACPK,mBAAmB,CAAC2D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,SAD4B;AAEnCC,MAAAA,KAAK,EAAEtE,OAAO,CAACuE,CAAR,CAAU,iCAAV,CAF4B;AAGnCpC,MAAAA,IAAI,EAAEnC,OAAO,CAACuE,CAAR,CAAU,iCAAV,CAH6B;AAInCU,MAAAA,OAAO,EAAElF;AAJ0B,KAArC,CADO,CAAT;AAQA,UAAMK,GAAG,CAACI,mBAAmB,CAAC4E,oBAApB,CAAyCjD,IAAzC,CAAD,CAAT;AACD;AACF;;AAED,UAAUN,aAAV,QAOE;AAAA,MAPsB;AACtBqB,IAAAA;AADsB,GAOtB;AACA,QAAMC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAAC8E,OAAnB,EAA4BnC,OAA5B,CAA3B;;AAEA,MAAIC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACI,mBAAmB,CAAC8E,kBAApB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AAAEhC,MAAAA;AAAF,QAAaH,QAAQ,CAACM,IAA5B;AACA,QAAIH,MAAM,CAACiC,GAAX,EAAgBC,MAAM,CAACC,IAAP,CAAYnC,MAAM,CAACiC,GAAnB,EAAwB,QAAxB;AAChB,UAAMnF,GAAG,CAACI,mBAAmB,CAACkF,oBAApB,EAAD,CAAT;AACD;AACF;;AAGD,UAAUzD,UAAV,SASE;AAAA,MATmB;AACnBiB,IAAAA,OAAO,EAAE;AAAEc,MAAAA,EAAF;AAAK2B,MAAAA;AAAL;AADU,GASnB;AACA,QAAMxC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACqF,UAAnB,EAA+B5B,EAA/B,EAAkC2B,GAAlC,CAA3B;;AACA,MAAIxC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACI,mBAAmB,CAACqF,wBAApB,CAA6C;AAACF,MAAAA;AAAD,KAA7C,CAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAMvF,GAAG,CAACI,mBAAmB,CAACsF,0BAApB,CAA+C;AAAEH,MAAAA;AAAF,KAA/C,CAAD,CAAT;AACA,UAAMvF,GAAG,CAACI,mBAAmB,CAACU,2BAApB,CAAgD8C,EAAhD,CAAD,CAAT;AACD;AACF;;AAGD,UAAUjC,aAAV,SAQE;AAAA,MARsB;AACtBmB,IAAAA,OAAO,EAAE;AAAEc,MAAAA,EAAF;AAAK+B,MAAAA,OAAL;AAAaJ,MAAAA;AAAb;AADa,GAQtB;AACA,QAAMxC,QAAQ,GAAG,MAAMhD,IAAI,CAACI,iBAAiB,CAACyF,UAAnB,EAA+BhC,EAA/B,EAAkC;AAAC+B,IAAAA,OAAO,EAACA,OAAT;AAAiBJ,IAAAA,GAAG,EAACA;AAArB,GAAlC,CAA3B;;AACA,MAAIxC,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAMhD,GAAG,CAACI,mBAAmB,CAACyF,sBAApB,CAA2C;AAAEN,MAAAA;AAAF,KAA3C,CAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAMvF,GAAG,CAACI,mBAAmB,CAAC0F,wBAApB,CAA6C;AAAEP,MAAAA;AAAF,KAA7C,CAAD,CAAT;AACA,UAAMvF,GAAG,CAACI,mBAAmB,CAACU,2BAApB,CAAgD8C,EAAhD,CAAD,CAAT;AACD;AACF","sourcesContent":["import createCSV from \".,/../../src/utils/createCSV\";\nimport { PayloadAction } from \"@reduxjs/toolkit\";\nimport { AxiosResponse } from \"axios\";\nimport { DeleteFileType } from \"component/admin/ExpandableFile/types\";\nimport { goBack } from \"connected-react-router\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { PickerFileRequestType } from \"pages/pickers/detailPicker/types\";\nimport { actions } from \"reducers/pickers\";\nimport { NotificationStateType } from \"reducers/types/notification\";\nimport {\n  call,\n  CallEffect,\n  put,\n  PutEffect,\n  takeLatest,\n} from \"redux-saga/effects\";\nimport { DATE_FORMATS } from \"utils/constants\";\nimport * as pickersMiddleware from \"../middleware/pickers\";\nimport {\n  AcountDataType,\n  DetailPickerTagFileType,\n  EditPickerResponseType,\n  FilesType,\n  ParamsMiddlewareType,\n  PersonalDataType,\n  PickerFileResponseType,\n  PickersAxiosResponseType,\n  PickersExportResponseType,\n  PickersResponse,\n  PickerType,\n  StatusType,\n  VehicleType,\n} from \"../pages/pickers/types\";\nimport { actions as detailPickerActions } from \"../reducers/detailPicker\";\nimport { actions as notificationActions } from \"../reducers/notification\";\nimport {\n  CsvResponseType,\n  PickerResponseType,\n  PickersResponseType,\n} from \"./types/pickers\";\n\nconst sagas = [\n  takeLatest(actions.getPendingUserRequest.type, getPickers),\n  takeLatest(actions.getPendingUserExportRequest.type, getPendingUserExport),\n  takeLatest(actions.getMorePendingUserRequest.type, getMorePendingUser),\n  takeLatest(\n    detailPickerActions.getPendingUserPickerRequest.type,\n    getPendingUserPicker\n  ),\n  takeLatest(\n    detailPickerActions.getPendingUserPickerExportRequest.type,\n    getPendingUserPickerExport\n  ),\n  takeLatest(\n    detailPickerActions.getPendingUserPickerDocumentsEditRequest.type,\n    postPendingUserDocumentsEdit\n  ),\n  takeLatest(detailPickerActions.getAprovePickerRequest.type, postAprovePicker),\n  takeLatest(detailPickerActions.getEditPickerRequest.type, postEditPicker),\n  takeLatest(detailPickerActions.getPickerFileRequest.type, getPickerFile),\n  takeLatest(detailPickerActions.getPickerFileSaveRequest.type, putFileUpload),\n  takeLatest(detailPickerActions.getPickerFileDeleteRequest.type, fileDelete),\n];\n\nexport default sagas;\n\nconst process = (body: {\n  id: number;\n  enable: boolean;\n  registerDatetime: string;\n  status: StatusType;\n  personalData: PersonalDataType;\n  accountingData: AcountDataType;\n  vehicle: VehicleType;\n  files: FilesType;\n}) => {\n  return {\n    ...body,\n\n    personalData: {\n      ...body.personalData,\n      dateOfBirth: moment(\n        body.personalData.dateOfBirth,\n        DATE_FORMATS.shortDate\n      ).format(DATE_FORMATS.shortISODate),\n    },\n    accountingData: {\n      ...body.accountingData,\n      fiscalNumber:\n        body.accountingData.fiscalNumber.slice(0, 2) +\n        body.accountingData.fiscalNumber.slice(5, 13) +\n        body.accountingData.fiscalNumber.slice(16, 17),\n    },\n    vehicle: {\n      ...body.vehicle,\n\n      expirationDatePolicyVehicle:\n        body.vehicle.expirationDatePolicyVehicle &&\n        body.vehicle.expirationDatePolicyVehicle.match(\n          DATE_FORMATS.regexshortDate\n        )\n          ? moment(\n              body.vehicle.expirationDatePolicyVehicle,\n              DATE_FORMATS.shortDate\n            ).format(DATE_FORMATS.shortISODate)\n          : body.vehicle.expirationDatePolicyVehicle,\n      expirationDateIdentificationVehicle:\n        body.vehicle.expirationDateIdentificationVehicle &&\n        body.vehicle.expirationDateIdentificationVehicle.match(\n          DATE_FORMATS.regexshortDate\n        )\n          ? moment(\n              body.vehicle.expirationDateIdentificationVehicle,\n              DATE_FORMATS.shortDate\n            ).format(DATE_FORMATS.shortISODate)\n          : body.vehicle.expirationDateIdentificationVehicle,\n      expirationDateDriverLicense:\n        body.vehicle.expirationDateDriverLicense &&\n        body.vehicle.expirationDateDriverLicense.match(\n          DATE_FORMATS.regexshortDate\n        )\n          ? moment(\n              body.vehicle.expirationDateDriverLicense,\n              DATE_FORMATS.shortDate\n            ).format(DATE_FORMATS.shortISODate)\n          : body.vehicle.expirationDateDriverLicense,\n    },\n  };\n};\nfunction* getPickers({\n  payload,\n}: PayloadAction<ParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PickersAxiosResponseType>>\n  | PutEffect<{ type: string; pendingUsers: PickersResponse }>\n  | PutEffect<{ type: string }>,\n  void,\n  PickersResponseType\n> {\n  const response = yield call(pickersMiddleware.getPickers, payload);\n  if (response.status !== 200) {\n    yield put(actions.getPendingUserError());\n  } else {\n    const {\n      result: { items },\n      ...rest\n    } = response.data;\n    yield put(actions.getPendingUserSuccess({ items, ...rest }));\n  }\n}\n\nfunction* getMorePendingUser({\n  payload,\n}: PayloadAction<ParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PickersAxiosResponseType>>\n  | PutEffect<{ type: string }>,\n  void,\n  PickersResponseType\n> {\n  const response = yield call(pickersMiddleware.getPickers, payload);\n  if (response.status !== 200) {\n    yield put(actions.getPendingUserError());\n  } else {\n    const {\n      result: { items },\n      ...rest\n    } = response.data;\n    yield put(actions.getMorePendingUserSuccess({ items, ...rest }));\n  }\n}\n\nfunction* getPendingUserPicker({\n  payload,\n}: PayloadAction<number>): Generator<\n  CallEffect<AxiosResponse<PickerType>> | PutEffect<{ type: string }>,\n  void,\n  PickerResponseType\n> {\n  const response = yield call(pickersMiddleware.getPicker, payload);\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPendingUserPickerError());\n  } else {\n    const { result } = response.data;\n    yield put(detailPickerActions.getPendingUserPickerSuccess(result));\n    yield put(\n      actions.setActualPage(\n        result.status.id === 4 || result.status.id === 5 ? \"ACTIVE\" : \"PENDING\"\n      )\n    );\n  }\n}\n\nfunction* getPendingUserExport({\n  payload,\n}: PayloadAction<ParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PickersExportResponseType>>\n  | PutEffect<{ type: string }>,\n  void,\n  CsvResponseType\n> {\n  const response = yield call(pickersMiddleware.getPickersExport, payload);\n\n  if (response.status !== 200) {\n    yield put(actions.getPendingUserExportError());\n  } else {\n    createCSV(response.data, \"pickers\");\n    yield put(actions.getPendingUserExportSuccess());\n    yield put(\n      notificationActions.showNotification({\n        level: \"success\",\n        title: i18next.t(\"global:title.modal.export\"),\n        body: i18next.t(\"global:label.modal.export\"),\n      })\n    );\n  }\n}\n\nfunction* getPendingUserPickerExport({\n  payload: { email },\n}: PayloadAction<ParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PickersExportResponseType>>\n  | PutEffect<{ type: string }>,\n  void,\n  CsvResponseType\n> {\n  const response = yield call(pickersMiddleware.getPickerExport, { email });\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPendingUserPickerExportError());\n  } else {\n    createCSV(response.data, \"pickers\");\n    yield put(\n      notificationActions.showNotification({\n        level: \"success\",\n        title: i18next.t(\"global:title.modal.export\"),\n        body: i18next.t(\"global:label.modal.export\"),\n      })\n    );\n    yield put(detailPickerActions.getPendingUserPickerExportSuccess());\n  }\n}\n\nfunction* postPendingUserDocumentsEdit({\n  payload,\n}: PayloadAction<PickerType>): Generator<\n  | CallEffect<AxiosResponse<EditPickerResponseType>>\n  | PutEffect<{ type: string; content: NotificationStateType }>\n  | PutEffect<{ type: string }>,\n  void,\n  PickerResponseType\n> {\n  let body = process(payload);\n  const response = yield call(pickersMiddleware.postPickerDocumentsEdit, body);\n\n  if (response.status !== 200) {\n    yield put(\n      notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"global:title.modal.connectionError\"),\n        body: i18next.t(\"global:label.modal.connectionError\"),\n      })\n    );\n    yield put(detailPickerActions.getPendingUserPickerDocumentsEditError());\n  } else {\n    yield put(goBack());\n    yield put(\n      detailPickerActions.getPendingUserPickerDocumentsEditSuccess(body)\n    );\n  }\n}\n\nfunction* postAprovePicker({\n  payload: { params, goBack },\n}: PayloadAction<{ params: PickerType; goBack: Function }>): Generator<\n  | CallEffect<AxiosResponse<EditPickerResponseType>>\n  | PutEffect<{ type: string; content: NotificationStateType }>\n  | PutEffect<{ type: string }>,\n  void,\n  PickerResponseType\n> {\n  let body = process(params);\n  const response = yield call(pickersMiddleware.postAprovePicker, body);\n  if (response.status !== 200) {\n    yield put(\n      notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"global:title.modal.connectionError\"),\n        body: i18next.t(\"global:label.modal.connectionError\"),\n      })\n    );\n    yield put(detailPickerActions.getAprovePickerError());\n  } else {\n    yield put(\n      notificationActions.showNotification({\n        level: \"success\",\n        title: i18next.t(\"detailPicker:title.modal.approved\"),\n        body: i18next.t(\"detailPicker:label.modal.approved\"),\n        onClick: goBack,\n      })\n    );\n    yield put(detailPickerActions.getAprovePickerSuccess(body));\n  }\n}\n\nfunction* postEditPicker({\n  payload: { params, goBack },\n}: PayloadAction<{ params: PickerType; goBack: Function }>): Generator<\n  | CallEffect<AxiosResponse<EditPickerResponseType>>\n  | PutEffect<{ type: string; content: NotificationStateType }>\n  | PutEffect<{ type: string }>,\n  void,\n  PickerResponseType\n> {\n  let body = process(params);\n  const response = yield call(pickersMiddleware.postEditPicker, body);\n  if (response.status !== 200) {\n    yield put(\n      notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"global:title.modal.connectionError\"),\n        body: i18next.t(\"global:label.modal.connectionError\"),\n      })\n    );\n    yield put(detailPickerActions.getEditPickerError());\n  } else {\n    yield put(\n      notificationActions.showNotification({\n        level: \"success\",\n        title: i18next.t(\"global:title.modal.changesSaved\"),\n        body: i18next.t(\"global:label.modal.changesSaved\"),\n        onClick: goBack,\n      })\n    );\n    yield put(detailPickerActions.getEditPickerSuccess(body));\n  }\n}\n\nfunction* getPickerFile({\n  payload,\n}: PayloadAction<PickerFileRequestType>): Generator<\n  | CallEffect<AxiosResponse<PickerFileResponseType>>\n  | PutEffect<{ type: string }>,\n  void,\n  { status: number; data: PickerFileResponseType }\n> {\n  const response = yield call(pickersMiddleware.getFile, payload);\n\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPickerFileError());\n  } else {\n    const { result } = response.data;\n    if (result.url) window.open(result.url, \"_blank\");\n    yield put(detailPickerActions.getPickerFileSuccess());\n  }\n}\n\n\nfunction* fileDelete({\n  payload: { id,tag },\n}: PayloadAction<DeleteFileType>): Generator<\n| PutEffect<{ type: string }>\n|CallEffect<AxiosResponse<any>>\n|Promise<AxiosResponse<any>>\n| void,\n  void,\n  { status: number; data: {} }\n> {\n  const response = yield call(pickersMiddleware.deleteFile, id,tag);\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPickerFileDeleteError({tag}));\n  } else {\n    yield put(detailPickerActions.getPickerFileDeleteSuccess({ tag }));\n    yield put(detailPickerActions.getPendingUserPickerRequest(id));\n  }\n}\n\n\nfunction* putFileUpload({\n  payload: { id,content,tag },\n}: PayloadAction<{id:number,content:string,tag:keyof DetailPickerTagFileType}>): Generator<\n| CallEffect<AxiosResponse<{}>>\n| PutEffect<{ type: string }>\n| void,\n  void,\n  { status: number; data: {} }\n> {\n  const response = yield call(pickersMiddleware.fileUpload, id,{content:content,tag:tag} );\n  if (response.status !== 200) {\n    yield put(detailPickerActions.getPickerFileSaveError({ tag }));\n  } else {\n    yield put(detailPickerActions.getPickerFileSaveSuccess({ tag }));\n    yield put(detailPickerActions.getPendingUserPickerRequest(id));\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}