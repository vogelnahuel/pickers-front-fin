{"ast":null,"code":"import moment from \"moment\";\nimport { call, put, takeLatest } from \"redux-saga/effects\";\nimport { DATE_FORMATS } from \"utils/constants\";\nimport * as preliquidationsMiddleware from \"../middleware/preliquidations\";\nimport { actions as notificationActions } from \"../reducers/notification\";\nimport { actions as preliquidationActions } from \"../reducers/preliquidation\";\nimport i18next from \"i18next\";\nimport { replace } from \"connected-react-router\";\nconst sagas = [takeLatest(preliquidationActions.getPreliquidationsRequest.type, getPreliquidations), takeLatest(preliquidationActions.getMorePreliquidationsRequest.type, getMorePreliquidations), takeLatest(preliquidationActions.getInvoiceDetailRequest.type, getInvoiceDetail), takeLatest(preliquidationActions.getInvoiceDetailSaveRequest.type, putSaveDetailInvoice), takeLatest(preliquidationActions.getInvoiceDetailApproveRequest.type, patchApproveDetailInvoice), takeLatest(preliquidationActions.getInvoiceDetailDeleteRequest.type, putDeleteDetailInvoice), takeLatest(preliquidationActions.uploadInvoiceFile.type, uploadInvoiceFile), takeLatest(preliquidationActions.deleteInvoiceFileRequest.type, deleteInvoiceFile), takeLatest(preliquidationActions.getInvoiceDetailTypesRequest.type, getDetailInvoiceTypes)];\nexport default sagas;\n\nconst process = body => {\n  return { ...body,\n    emisionDate: body !== null && body !== void 0 && body.emisionDate ? moment(body === null || body === void 0 ? void 0 : body.emisionDate, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate) : null\n  };\n};\n\nconst processDatePicker = payload => {\n  let payloadCast = payload;\n\n  if (payload.generatedAt) {\n    var _payload$generatedAt;\n\n    const castDatePicker = moment((_payload$generatedAt = payload.generatedAt) === null || _payload$generatedAt === void 0 ? void 0 : _payload$generatedAt.from, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate);\n    payloadCast = { ...payload,\n      generatedAt: castDatePicker\n    };\n  }\n\n  return payloadCast;\n};\n\nfunction* getPreliquidations(_ref) {\n  let {\n    payload\n  } = _ref;\n\n  if ((payload === null || payload === void 0 ? void 0 : payload.status) === \"\") {\n    delete payload[\"status\"];\n  }\n\n  let payloadCast = processDatePicker(payload);\n  const response = yield call(preliquidationsMiddleware.getPreliquidations, payloadCast);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getPreliquidationsError());\n  } else {\n    yield put(preliquidationActions.getPreliquidationsSuccess(response.data));\n  }\n}\n\nfunction* getMorePreliquidations(_ref2) {\n  let {\n    payload\n  } = _ref2;\n  let payloadCast = processDatePicker(payload);\n  const response = yield call(preliquidationsMiddleware.getPreliquidations, payloadCast);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getMorePreliquidationsError());\n  } else {\n    const {\n      result: {\n        items\n      },\n      ...rest\n    } = response.data;\n    yield put(preliquidationActions.getMorePreliquidationsSuccess({\n      items,\n      ...rest\n    }));\n  }\n}\n\nfunction* getInvoiceDetail(_ref3) {\n  let {\n    payload\n  } = _ref3;\n  const response = yield call(preliquidationsMiddleware.getDetailInvoice, payload);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailError());\n  } else {\n    const {\n      result\n    } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailSuccess(result));\n  }\n}\n\nfunction* putSaveDetailInvoice(_ref4) {\n  var _payload$emisionDate, _payload$invoiceType;\n\n  let {\n    payload\n  } = _ref4;\n  let result = {\n    emisionDate: typeof payload.emisionDate !== \"string\" ? (_payload$emisionDate = payload.emisionDate) === null || _payload$emisionDate === void 0 ? void 0 : _payload$emisionDate.from : null,\n    invoiceType: (_payload$invoiceType = payload.invoiceType) !== null && _payload$invoiceType !== void 0 && _payload$invoiceType.tag ? payload.invoiceType : null,\n    invoiceNumber: payload.invoiceNumber || null,\n    salePoint: payload.salePoint || null,\n    caeNumber: payload.caeNumber || null\n  };\n  result = process(result);\n  const response = yield call(preliquidationsMiddleware.putSaveDetailInvoice, payload.presettementId, result);\n\n  if (response.status !== 200) {\n    yield put(notificationActions.showNotification({\n      level: \"error\",\n      title: i18next.t(\"global:title.modal.connectionError\"),\n      body: i18next.t(\"global:label.modal.connectionError\")\n    }));\n    yield put(preliquidationActions.getInvoiceDetailSaveError());\n  } else {\n    yield put(replace(\"/preliquidation\"));\n    yield put(preliquidationActions.getInvoiceDetailSaveSuccess());\n  }\n}\n\nfunction* patchApproveDetailInvoice(_ref5) {\n  var _payload$emisionDate2;\n\n  let {\n    payload\n  } = _ref5;\n  let result = {\n    emisionDate: typeof payload.emisionDate !== \"string\" ? (_payload$emisionDate2 = payload.emisionDate) === null || _payload$emisionDate2 === void 0 ? void 0 : _payload$emisionDate2.from : \"\",\n    invoiceType: payload.invoiceType,\n    invoiceNumber: payload.invoiceNumber,\n    salePoint: payload.salePoint,\n    caeNumber: payload.caeNumber\n  };\n  result = process(result);\n  const response = yield call(preliquidationsMiddleware.patchApproveDetailInvoice, payload.presettementId, result);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailApproveError());\n  } else {\n    yield put(replace(\"/preliquidation\"));\n  }\n}\n\nfunction* putDeleteDetailInvoice(_ref6) {\n  let {\n    payload\n  } = _ref6;\n  const response = yield call(preliquidationsMiddleware.putDeleteDetailInvoice, payload.presettlementId);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailDeleteError());\n  } else {\n    yield put(replace(\"/preliquidation\"));\n    yield put(preliquidationActions.getInvoiceDetailDeleteSuccess());\n  }\n}\n\nfunction* uploadInvoiceFile(_ref7) {\n  let {\n    payload\n  } = _ref7;\n  const response = yield call(preliquidationsMiddleware.uploadInvoiceFile, payload);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.uploadInvoiceFileError());\n  } else {\n    if (payload.refreshPage) {\n      yield put(preliquidationActions.getInvoiceDetailRequest(payload.id.toString()));\n      yield put(preliquidationActions.setInvoiceFileStatus({\n        loading: false\n      }));\n    } else yield put(preliquidationActions.uploadInvoiceFileSuccess(payload.content));\n  }\n}\n\nfunction* deleteInvoiceFile(_ref8) {\n  let {\n    payload\n  } = _ref8;\n  const response = yield call(preliquidationsMiddleware.deleteInvoiceFile, payload.id);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.deleteInvoiceFileError());\n  } else {\n    yield put(preliquidationActions.getInvoiceDetailRequest(payload.id.toString()));\n  }\n}\n\nfunction* getDetailInvoiceTypes() {\n  const response = yield call(preliquidationsMiddleware.getDetailInvoiceTypes);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailTypesError());\n  } else {\n    const {\n      result\n    } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailTypesSuccess(result));\n  }\n}","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/sagas/preliquidation.ts"],"names":["moment","call","put","takeLatest","DATE_FORMATS","preliquidationsMiddleware","actions","notificationActions","preliquidationActions","i18next","replace","sagas","getPreliquidationsRequest","type","getPreliquidations","getMorePreliquidationsRequest","getMorePreliquidations","getInvoiceDetailRequest","getInvoiceDetail","getInvoiceDetailSaveRequest","putSaveDetailInvoice","getInvoiceDetailApproveRequest","patchApproveDetailInvoice","getInvoiceDetailDeleteRequest","putDeleteDetailInvoice","uploadInvoiceFile","deleteInvoiceFileRequest","deleteInvoiceFile","getInvoiceDetailTypesRequest","getDetailInvoiceTypes","process","body","emisionDate","shortDate","format","shortISODate","processDatePicker","payload","payloadCast","generatedAt","castDatePicker","from","status","response","getPreliquidationsError","getPreliquidationsSuccess","data","getMorePreliquidationsError","result","items","rest","getMorePreliquidationsSuccess","getDetailInvoice","getInvoiceDetailError","getInvoiceDetailSuccess","invoiceType","tag","invoiceNumber","salePoint","caeNumber","presettementId","showNotification","level","title","t","getInvoiceDetailSaveError","getInvoiceDetailSaveSuccess","getInvoiceDetailApproveError","presettlementId","getInvoiceDetailDeleteError","getInvoiceDetailDeleteSuccess","uploadInvoiceFileError","refreshPage","id","toString","setInvoiceFileStatus","loading","uploadInvoiceFileSuccess","content","deleteInvoiceFileError","getInvoiceDetailTypesError","getInvoiceDetailTypesSuccess"],"mappings":"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","sourcesContent":["import { PayloadAction } from \"@reduxjs/toolkit\";\nimport { AxiosResponse } from \"axios\";\nimport moment from \"moment\";\nimport { ApiResponse } from \"middleware/api\";\nimport { detailPreliquidationDatePicker } from \"pages/preliquidation/DetailPreliquidation/invoice/types\";\n\nimport {\n  call,\n  CallEffect,\n  put,\n  PutEffect,\n  takeLatest,\n} from \"redux-saga/effects\";\nimport { DATE_FORMATS } from \"utils/constants\";\nimport * as preliquidationsMiddleware from \"../middleware/preliquidations\";\nimport { actions as notificationActions } from \"../reducers/notification\";\nimport { actions as preliquidationActions } from \"../reducers/preliquidation\";\nimport {\n  DetailPreliquidationBodyParamsType,\n  DetailPreliquidationsApiResponseType,\n  DetailPreliquidationsContentResponseType,\n  DetailPreliquidationsInvoiceApiResponseType,\n  DetailPreliquidationsInvoiceTypesApiResponseType,\n  PreliquidationCastParamsMiddlewareType,\n  PreliquidationParamsMiddlewareType,\n  PreliquidationsApiResponse,\n  RejectInvoiceMiddlewareType,\n  UploadInvoiceFileMiddlewareType,\n} from \"./types/preliquidation\";\nimport i18next from \"i18next\";\nimport { NotificationStateType } from \"reducers/types/notification\";\nimport { replace } from \"connected-react-router\";\n\nconst sagas = [\n  takeLatest(\n    preliquidationActions.getPreliquidationsRequest.type,\n    getPreliquidations\n  ),\n  takeLatest(\n    preliquidationActions.getMorePreliquidationsRequest.type,\n    getMorePreliquidations\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailRequest.type,\n    getInvoiceDetail\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailSaveRequest.type,\n    putSaveDetailInvoice\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailApproveRequest.type,\n    patchApproveDetailInvoice\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailDeleteRequest.type,\n    putDeleteDetailInvoice\n  ),\n  takeLatest(preliquidationActions.uploadInvoiceFile.type, uploadInvoiceFile),\n  takeLatest(\n    preliquidationActions.deleteInvoiceFileRequest.type,\n    deleteInvoiceFile\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailTypesRequest.type,\n    getDetailInvoiceTypes\n  ),\n];\n\nexport default sagas;\n\nconst process = (body: DetailPreliquidationBodyParamsType) => {\n  return {\n    ...body,\n    emisionDate: body?.emisionDate\n      ? moment(body?.emisionDate, DATE_FORMATS.shortDate).format(\n          DATE_FORMATS.shortISODate\n        )\n      : null,\n  };\n};\n\nconst processDatePicker = (\n  payload: PreliquidationParamsMiddlewareType\n): PreliquidationCastParamsMiddlewareType => {\n  let payloadCast: PreliquidationCastParamsMiddlewareType =\n    payload as PreliquidationCastParamsMiddlewareType;\n  if (payload.generatedAt) {\n    const castDatePicker = moment(\n      payload.generatedAt?.from,\n      DATE_FORMATS.shortDate\n    ).format(DATE_FORMATS.shortISODate);\n\n    payloadCast = {\n      ...payload,\n      generatedAt: castDatePicker,\n    };\n  }\n\n  return payloadCast;\n};\n\nfunction* getPreliquidations({\n  payload,\n}: PayloadAction<PreliquidationParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PreliquidationsApiResponse>>\n  | PutEffect<{ type: string }>,\n  void,\n  PreliquidationsApiResponse\n> {\n  if (payload?.status === \"\") {\n    delete payload[\"status\"];\n  }\n  let payloadCast: PreliquidationCastParamsMiddlewareType =\n    processDatePicker(payload);\n\n  const response = yield call(\n    preliquidationsMiddleware.getPreliquidations,\n    payloadCast\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getPreliquidationsError());\n  } else {\n    yield put(preliquidationActions.getPreliquidationsSuccess(response.data));\n  }\n}\n\nfunction* getMorePreliquidations({\n  payload,\n}: PayloadAction<PreliquidationParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PreliquidationsApiResponse>>\n  | PutEffect<{ type: string }>,\n  void,\n  PreliquidationsApiResponse\n> {\n  let payloadCast: PreliquidationCastParamsMiddlewareType =\n    processDatePicker(payload);\n  const response = yield call(\n    preliquidationsMiddleware.getPreliquidations,\n    payloadCast\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getMorePreliquidationsError());\n  } else {\n    const {\n      result: { items },\n      ...rest\n    } = response.data;\n    yield put(\n      preliquidationActions.getMorePreliquidationsSuccess({ items, ...rest })\n    );\n  }\n}\n\nfunction* getInvoiceDetail({\n  payload,\n}: PayloadAction<string | undefined>): Generator<\n  | PutEffect<{\n      payload: DetailPreliquidationsContentResponseType;\n      type: string;\n    }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsContentResponseType>>,\n  void,\n  DetailPreliquidationsApiResponseType\n> {\n  const response = yield call(\n    preliquidationsMiddleware.getDetailInvoice,\n    payload\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailError());\n  } else {\n    const { result } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailSuccess(result));\n  }\n}\n\nfunction* putSaveDetailInvoice({\n  payload,\n}: PayloadAction<detailPreliquidationDatePicker>): Generator<\n  | PutEffect<{ payload: detailPreliquidationDatePicker; type: string }>\n  | PutEffect<{ type: string }>\n  | PutEffect<{ type: string; content: NotificationStateType }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceApiResponseType\n> {\n  let result: DetailPreliquidationBodyParamsType = {\n    emisionDate:\n      typeof payload.emisionDate !== \"string\"\n        ? payload.emisionDate?.from\n        : null,\n    invoiceType: payload.invoiceType?.tag ? payload.invoiceType : null,\n    invoiceNumber: payload.invoiceNumber || null,\n    salePoint: payload.salePoint || null,\n    caeNumber: payload.caeNumber || null,\n  };\n  result = process(result);\n\n  const response = yield call(\n    preliquidationsMiddleware.putSaveDetailInvoice,\n    payload.presettementId,\n    result\n  );\n  if (response.status !== 200) {\n    yield put(\n      notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"global:title.modal.connectionError\"),\n        body: i18next.t(\"global:label.modal.connectionError\"),\n      })\n    );\n    yield put(preliquidationActions.getInvoiceDetailSaveError());\n  } else {\n    yield put(replace(\"/preliquidation\"))\n    yield put(preliquidationActions.getInvoiceDetailSaveSuccess());\n  }\n}\n\nfunction* patchApproveDetailInvoice({\n  payload,\n}: PayloadAction<detailPreliquidationDatePicker>): Generator<\n  | PutEffect<{ payload: detailPreliquidationDatePicker; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceApiResponseType\n> {\n  let result: DetailPreliquidationBodyParamsType = {\n    emisionDate:\n      typeof payload.emisionDate !== \"string\" ? payload.emisionDate?.from : \"\",\n    invoiceType: payload.invoiceType,\n    invoiceNumber: payload.invoiceNumber,\n    salePoint: payload.salePoint,\n    caeNumber: payload.caeNumber,\n  };\n  result = process(result);\n\n  const response = yield call(\n    preliquidationsMiddleware.patchApproveDetailInvoice,\n    payload.presettementId,\n    result\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailApproveError());\n  } else {\n    yield put(replace(\"/preliquidation\"))\n  }\n}\n\nfunction* putDeleteDetailInvoice({\n  payload,\n}: PayloadAction<RejectInvoiceMiddlewareType>): Generator<\n  | PutEffect<{ payload: detailPreliquidationDatePicker; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceApiResponseType\n> {\n  const response = yield call(\n    preliquidationsMiddleware.putDeleteDetailInvoice,\n    payload.presettlementId\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailDeleteError());\n  } else {\n    yield put(replace(\"/preliquidation\"))\n    yield put(preliquidationActions.getInvoiceDetailDeleteSuccess());\n  }\n}\n\nfunction* uploadInvoiceFile({\n  payload,\n}: PayloadAction<UploadInvoiceFileMiddlewareType>): Generator<\n  | PutEffect<{ payload: string; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<ApiResponse<void>>>,\n  void,\n  ApiResponse<void>\n> {\n  const response = yield call(\n    preliquidationsMiddleware.uploadInvoiceFile,\n    payload\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.uploadInvoiceFileError());\n  } else {\n    if(payload.refreshPage){\n      yield put(preliquidationActions.getInvoiceDetailRequest(payload.id.toString()))\n      yield put(preliquidationActions.setInvoiceFileStatus({ loading: false }));\n    }else\n      yield put(preliquidationActions.uploadInvoiceFileSuccess(payload.content));\n  }\n}\n\nfunction* deleteInvoiceFile({\n  payload,\n}: PayloadAction<{ id: number }>): Generator<\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ payload: string | undefined; type: string }>\n  | CallEffect<AxiosResponse<ApiResponse<void>>>,\n  void,\n  ApiResponse<void>\n> {\n  const response = yield call(\n    preliquidationsMiddleware.deleteInvoiceFile,\n    payload.id\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.deleteInvoiceFileError());\n  } else {\n    yield put(preliquidationActions.getInvoiceDetailRequest(payload.id.toString()));\n  }\n}\n\nfunction* getDetailInvoiceTypes(): Generator<\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceTypesApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceTypesApiResponseType\n> {\n  const response = yield call(preliquidationsMiddleware.getDetailInvoiceTypes);\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailTypesError());\n  } else {\n    const { result } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailTypesSuccess(result));\n  }\n}\n"]},"metadata":{},"sourceType":"module"}