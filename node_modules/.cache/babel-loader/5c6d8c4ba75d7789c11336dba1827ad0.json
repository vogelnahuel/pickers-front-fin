{"ast":null,"code":"var _jsxFileName = \"/home/nahuel/pickers-admin-front/src/pages/preliquidation/DetailPreliquidation/invoice/InvoiceContainer.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\nimport Invoice from \"./Invoice\";\nimport { actions as preliActions, preliquidationSelector } from \"reducers/preliquidation\";\nimport { actions as notificationActions } from \"reducers/notification\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport * as yup from \"yup\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { DATE_FORMATS, MAX_FILE_SIZE, VALIDATION_REGEX } from \"utils/constants\";\nimport { getBase64FromUrl, isBase64, toBase64 } from \"utils/toBase64\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst InvoiceContainer = props => {\n  _s();\n\n  const params = useParams();\n  const history = useHistory();\n  useEffect(() => {\n    props.setInvoiceFileStatus({\n      loading: false,\n      error: false\n    });\n    props.getInvoiceDetailTypes();\n    props.getInvoiceDetail(params.id);\n    return () => props.resetInvoiceDetail(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fileHandler = async file => {\n    props.setInvoiceFileStatus({\n      loading: true\n    });\n\n    if (file.size > MAX_FILE_SIZE || file.type !== \"application/pdf\") {\n      props.setInvoiceFileStatus({\n        error: true,\n        loading: false,\n        message: \"component:label.pdfController.invalidFile\"\n      });\n      return;\n    } else {\n      try {\n        var _props$invoiceDetail, _props$invoiceDetail$;\n\n        const base64 = await toBase64(file);\n        const uploaded = (_props$invoiceDetail = props.invoiceDetail) === null || _props$invoiceDetail === void 0 ? void 0 : (_props$invoiceDetail$ = _props$invoiceDetail.invoiceFile) === null || _props$invoiceDetail$ === void 0 ? void 0 : _props$invoiceDetail$.upload;\n        !uploaded ? props.uploadInvoiceFile({\n          id: parseInt(params.id || \"0\"),\n          content: base64\n        }) : props.replaceInvoiceFile({\n          id: parseInt(params.id || \"0\"),\n          content: base64\n        });\n      } catch (err) {\n        console.log(\"Base64 error: \", err);\n      }\n    }\n  };\n\n  const handleClickBack = dirty => {\n    const onClose = () => history.goBack();\n\n    if (dirty) showDirtyNotification(onClose);else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);else onClose();\n  };\n\n  const showDirtyNotification = onClose => {\n    const html = document.documentElement;\n    const height = Math.max(html.clientHeight, html.scrollHeight);\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"pickers:title.modal.saveChanges\"),\n      body: i18next.t(\"pickers:label.modal.saveChanges\"),\n      onClickLabel: \"pickers:button.modal.goToSave\",\n      onCloseLabel: \"pickers:button.modal.notSave\",\n      onClose: onClose,\n      onClick: () => window.scroll({\n        top: height,\n        left: 0,\n        behavior: \"smooth\"\n      })\n    });\n  };\n\n  const showWrongFilesNotification = onClose => props.showNotification({\n    level: \"warning\",\n    title: i18next.t(\"global:title.modal.withoutSaving\"),\n    body: i18next.t(\"global:label.modal.withoutSaving\"),\n    onClickLabel: i18next.t(\"global:label.button.checkErrors\"),\n    onCloseLabel: i18next.t(\"global:label.button.continue\"),\n    onClose: onClose,\n    onClick: undefined\n  });\n\n  const changePage = (page, isDirty) => {\n    const onClose = () => props.setActualPage(page);\n\n    if (isDirty) showDirtyNotification(onClose);else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);else onClose();\n  };\n\n  const deleteFile = () => {\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"invoice:title.modal.deleteInvoice\"),\n      body: i18next.t(\"invoice:label.modal.deleteInvoice\"),\n      onClickLabel: \"invoice:button.modal.delete\",\n      onCloseLabel: \"invoice:button.modal.cancel\",\n      onClose: undefined,\n      onClick: () => props.deleteInvoiceFile(parseInt(params.id || \"0\"))\n    });\n  };\n\n  const goToPreviousFile = () => {\n    props.setInvoiceFileStatus({\n      error: false,\n      loading: false\n    });\n  };\n\n  const downloadFile = async () => {\n    var _props$invoiceDetail2, _props$invoiceDetail3;\n\n    const url = (_props$invoiceDetail2 = props.invoiceDetail) === null || _props$invoiceDetail2 === void 0 ? void 0 : (_props$invoiceDetail3 = _props$invoiceDetail2.invoiceFile) === null || _props$invoiceDetail3 === void 0 ? void 0 : _props$invoiceDetail3.url;\n    if (!url) return;\n    const now = new Date();\n    const date = `${now.getDate()}_${now.getMonth() + 1}_${now.getFullYear()}`;\n    const time = `${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`;\n    const downloadLink = document.createElement(\"a\");\n    const fileName = `preli-${params.id || \"\"}-${date}_${time}.pdf`;\n\n    if (isBase64(url)) {\n      downloadLink.href = url;\n    } else {\n      const base64 = await getBase64FromUrl(url);\n      downloadLink.href = base64;\n    }\n\n    downloadLink.download = fileName;\n    downloadLink.click();\n  };\n\n  const validarFechas = value => {\n    var _props$detailPreliqui;\n\n    if (!value) return true;\n    const valueProps = moment(value, \"DD/MM/YYYY\");\n    const today = moment();\n    const startDate = moment((_props$detailPreliqui = props.detailPreliquidations) === null || _props$detailPreliqui === void 0 ? void 0 : _props$detailPreliqui.generatedAt);\n    return valueProps.isBetween(startDate, today, \"day\", \"[]\");\n  };\n\n  const castDatePicker = detailPreliquidations => {\n    var _detailPreliquidation, _detailPreliquidation2, _detailPreliquidation3;\n\n    const {\n      emisionDate\n    } = detailPreliquidations;\n    return { ...detailPreliquidations,\n      caeNumber: (_detailPreliquidation = detailPreliquidations.caeNumber) !== null && _detailPreliquidation !== void 0 ? _detailPreliquidation : \"\",\n      invoiceNumber: (_detailPreliquidation2 = detailPreliquidations.invoiceNumber) !== null && _detailPreliquidation2 !== void 0 ? _detailPreliquidation2 : \"\",\n      salePoint: (_detailPreliquidation3 = detailPreliquidations.salePoint) !== null && _detailPreliquidation3 !== void 0 ? _detailPreliquidation3 : \"\",\n      emisionDate: detailPreliquidations.emisionDate ? moment(emisionDate).format(DATE_FORMATS.shortDate) : \"\"\n    };\n  };\n\n  const initialValues = useMemo(() => {\n    return castDatePicker(props.invoiceDetail); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.invoiceDetail.id, props.detailPreliquidations.status.tag, props.isFetching]);\n  const isFormEnabled = useMemo(() => {\n    const tag = props.detailPreliquidations.status.tag;\n    return [\"pending\", \"in_approvement\"].includes(tag);\n  }, [props.detailPreliquidations.status.tag]);\n  const validationSchema = yup.object({\n    emisionDate: yup.string().test(\"requireDatePicker\", \"\", value => !!value).test(\"errorDatePicker\", \"error.input.emisionDate\", value => validarFechas(value)),\n    invoiceType: yup.object({\n      name: yup.string().required(\"global:error.input.required\")\n    }),\n    salePoint: yup.string().min(4, i18next.t(\"global:error.input.salePoint\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.salePoint\")),\n    invoiceNumber: yup.string().min(8, i18next.t(\"global:error.input.invoiceNumber\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.invoiceNumber\")),\n    caeNumber: yup.string().min(14, i18next.t(\"global:error.input.caeNumber\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.caeNumber\"))\n  });\n  return /*#__PURE__*/_jsxDEV(Invoice, { ...props,\n    fileHandler: fileHandler,\n    deleteFile: deleteFile,\n    downloadFile: downloadFile,\n    validationSchema: validationSchema,\n    initialValues: initialValues,\n    isFormEnabled: isFormEnabled,\n    presettementId: params.id,\n    handleClickBack: handleClickBack,\n    changePage: changePage,\n    goToPreviousFile: goToPreviousFile\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 237,\n    columnNumber: 5\n  }, this);\n};\n\n_s(InvoiceContainer, \"d31r3JtDnLK7SGc5JEft4eR7gcI=\", false, function () {\n  return [useParams, useHistory];\n});\n\n_c = InvoiceContainer;\n\nconst mapStateToProps = state => ({\n  isFetching: preliquidationSelector(state).fetching,\n  invoiceDetail: preliquidationSelector(state).invoiceDetail,\n  detailPreliquidations: preliquidationSelector(state).detailPreliquidations,\n  invoiceFileStatus: preliquidationSelector(state).invoiceFileStatus,\n  invoiceTypes: preliquidationSelector(state).invoiceTypes,\n  approvingInvoice: preliquidationSelector(state).approvingInvoice\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setActualPage: page => {\n    dispatch(preliActions.setActualPage(page));\n  },\n  getInvoiceDetail: params => {\n    dispatch(preliActions.getInvoiceDetailRequest(params));\n  },\n  getInvoiceDetailSave: params => {\n    dispatch(preliActions.getInvoiceDetailSaveRequest(params));\n  },\n  getInvoiceDetailApprove: params => {\n    dispatch(preliActions.getInvoiceDetailApproveFetch(params));\n  },\n  getInvoiceDetailDelete: params => {\n    dispatch(preliActions.getInvoiceDetailDeleteRequest(params));\n  },\n  uploadInvoiceFile: params => {\n    dispatch(preliActions.uploadInvoiceFile(params));\n  },\n  replaceInvoiceFile: params => {\n    dispatch(preliActions.replaceInvoiceFile(params));\n  },\n  deleteInvoiceFile: id => {\n    dispatch(preliActions.deleteInvoiceFileRequest({\n      id\n    }));\n  },\n  getInvoiceDetailTypes: () => {\n    dispatch(preliActions.getInvoiceDetailTypesRequest());\n  },\n  resetInvoiceDetail: () => {\n    dispatch(preliActions.resetInvoiceDetail());\n  },\n  setDirty: dirty => {\n    dispatch(preliActions.setDirty(dirty));\n  },\n  showNotification: content => {\n    dispatch(notificationActions.showNotification(content));\n  },\n  setInvoiceFileStatus: params => {\n    dispatch(preliActions.setInvoiceFileStatus(params));\n  }\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InvoiceContainer);\n\nvar _c;\n\n$RefreshReg$(_c, \"InvoiceContainer\");","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/pages/preliquidation/DetailPreliquidation/invoice/InvoiceContainer.tsx"],"names":["useEffect","useMemo","connect","Invoice","actions","preliActions","preliquidationSelector","notificationActions","useHistory","useParams","yup","i18next","moment","DATE_FORMATS","MAX_FILE_SIZE","VALIDATION_REGEX","getBase64FromUrl","isBase64","toBase64","InvoiceContainer","props","params","history","setInvoiceFileStatus","loading","error","getInvoiceDetailTypes","getInvoiceDetail","id","resetInvoiceDetail","fileHandler","file","size","type","message","base64","uploaded","invoiceDetail","invoiceFile","upload","uploadInvoiceFile","parseInt","content","replaceInvoiceFile","err","console","log","handleClickBack","dirty","onClose","goBack","showDirtyNotification","invoiceFileStatus","showWrongFilesNotification","html","document","documentElement","height","Math","max","clientHeight","scrollHeight","showNotification","level","title","t","body","onClickLabel","onCloseLabel","onClick","window","scroll","top","left","behavior","undefined","changePage","page","isDirty","setActualPage","deleteFile","deleteInvoiceFile","goToPreviousFile","downloadFile","url","now","Date","date","getDate","getMonth","getFullYear","time","getHours","getMinutes","getSeconds","downloadLink","createElement","fileName","href","download","click","validarFechas","value","valueProps","today","startDate","detailPreliquidations","generatedAt","isBetween","castDatePicker","emisionDate","caeNumber","invoiceNumber","salePoint","format","shortDate","initialValues","status","tag","isFetching","isFormEnabled","includes","validationSchema","object","string","test","invoiceType","name","required","min","matches","regNumber","mapStateToProps","state","fetching","invoiceTypes","approvingInvoice","mapDispatchToProps","dispatch","getInvoiceDetailRequest","getInvoiceDetailSave","getInvoiceDetailSaveRequest","getInvoiceDetailApprove","getInvoiceDetailApproveFetch","getInvoiceDetailDelete","getInvoiceDetailDeleteRequest","deleteInvoiceFileRequest","getInvoiceDetailTypesRequest","setDirty"],"mappings":"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","sourcesContent":["import { useEffect, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { AppDispatch, RootState } from \"store\";\nimport Invoice from \"./Invoice\";\nimport {\n  actions as preliActions,\n  preliquidationSelector,\n} from \"reducers/preliquidation\";\nimport { actions as notificationActions } from \"reducers/notification\";\nimport {\n  detailPreliquidationDatePicker,\n  detailPreliquidationInvoiceContainerPropsType,\n  invoiceValidationSchema,\n} from \"./types\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport {\n  RejectInvoiceMiddlewareType,\n  UploadInvoiceFileMiddlewareType,\n} from \"sagas/types/preliquidation\";\nimport * as yup from \"yup\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { DATE_FORMATS, MAX_FILE_SIZE, VALIDATION_REGEX } from \"utils/constants\";\nimport { getBase64FromUrl, isBase64, toBase64 } from \"utils/toBase64\";\nimport {\n  InvoiceFileStatus,\n  DetailInvoiceType,\n} from \"reducers/types/preliquidation\";\nimport { NotificationStateType } from \"reducers/types/notification\";\nimport { PagesPreliquidationTypes } from \"../types\";\n\nconst InvoiceContainer = (\n  props: detailPreliquidationInvoiceContainerPropsType\n): JSX.Element => {\n  const params: { id?: string } = useParams();\n  const history = useHistory();\n  \n  useEffect(() => {\n    props.setInvoiceFileStatus({ loading: false, error: false });\n    props.getInvoiceDetailTypes();\n    props.getInvoiceDetail(params.id);\n\n    return () => props.resetInvoiceDetail();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fileHandler = async (file: File) => {\n    props.setInvoiceFileStatus({ loading: true });\n\n    if (file.size > MAX_FILE_SIZE || file.type !== \"application/pdf\") {\n      props.setInvoiceFileStatus({\n        error: true,\n        loading: false,\n        message: \"component:label.pdfController.invalidFile\",\n      });\n      return;\n    } else {\n      try {\n        const base64 = (await toBase64(file)) as string;\n        const uploaded = props.invoiceDetail?.invoiceFile?.upload;\n        !uploaded\n          ? props.uploadInvoiceFile({\n              id: parseInt(params.id || \"0\"),\n              content: base64,\n            })\n          : props.replaceInvoiceFile({\n              id: parseInt(params.id || \"0\"),\n              content: base64,\n            });\n      } catch (err) {\n        console.log(\"Base64 error: \", err);\n      }\n    }\n  };\n\n  const handleClickBack = (dirty: boolean) => {\n    const onClose = () => history.goBack();\n\n    if (dirty) showDirtyNotification(onClose);\n    else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);\n    else onClose();\n  };\n\n  const showDirtyNotification = (onClose: Function) => {\n    const html = document.documentElement;\n    const height = Math.max(html.clientHeight, html.scrollHeight);\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"pickers:title.modal.saveChanges\"),\n      body: i18next.t(\"pickers:label.modal.saveChanges\"),\n      onClickLabel: \"pickers:button.modal.goToSave\",\n      onCloseLabel: \"pickers:button.modal.notSave\",\n      onClose: onClose,\n      onClick: () =>\n        window.scroll({\n          top: height,\n          left: 0,\n          behavior: \"smooth\",\n        }),\n    });\n  };\n\n  const showWrongFilesNotification = (onClose: Function) =>\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"global:title.modal.withoutSaving\"),\n      body: i18next.t(\"global:label.modal.withoutSaving\"),\n      onClickLabel: i18next.t(\"global:label.button.checkErrors\"),\n      onCloseLabel: i18next.t(\"global:label.button.continue\"),\n      onClose: onClose,\n      onClick: undefined,\n    });\n\n  const changePage = (page: PagesPreliquidationTypes, isDirty: boolean) => {\n    const onClose = () => props.setActualPage(page);\n    if (isDirty) showDirtyNotification(onClose);\n    else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);\n    else onClose();\n  };\n\n  const deleteFile = () => {\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"invoice:title.modal.deleteInvoice\"),\n      body: i18next.t(\"invoice:label.modal.deleteInvoice\"),\n      onClickLabel: \"invoice:button.modal.delete\",\n      onCloseLabel: \"invoice:button.modal.cancel\",\n      onClose: undefined,\n      onClick: () => props.deleteInvoiceFile(parseInt(params.id || \"0\")),\n    });\n  };\n\n  const goToPreviousFile = () => {\n    props.setInvoiceFileStatus({\n      error: false,\n      loading: false,\n    });\n  };\n\n  const downloadFile = async () => {\n    const url = props.invoiceDetail?.invoiceFile?.url;\n    if (!url) return;\n\n    const now = new Date();\n    const date = `${now.getDate()}_${now.getMonth() + 1}_${now.getFullYear()}`;\n    const time = `${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`;\n    const downloadLink = document.createElement(\"a\");\n    const fileName = `preli-${params.id || \"\"}-${date}_${time}.pdf`;\n\n    if (isBase64(url)) {\n      downloadLink.href = url;\n    } else {\n      const base64 = (await getBase64FromUrl(url)) as string;\n      downloadLink.href = base64;\n    }\n    downloadLink.download = fileName;\n    downloadLink.click();\n  };\n\n  const validarFechas = (value: string | undefined) => {\n    if (!value) return true;\n\n    const valueProps = moment(value, \"DD/MM/YYYY\");\n    const today = moment();\n    const startDate = moment(props.detailPreliquidations?.generatedAt);\n\n    return valueProps.isBetween(startDate, today, \"day\", \"[]\");\n  };\n\n  const castDatePicker = (detailPreliquidations: DetailInvoiceType) => {\n    const { emisionDate } = detailPreliquidations;\n    return {\n      ...detailPreliquidations,\n      caeNumber: detailPreliquidations.caeNumber ?? \"\",\n      invoiceNumber: detailPreliquidations.invoiceNumber ?? \"\",\n      salePoint: detailPreliquidations.salePoint ?? \"\",\n      emisionDate: detailPreliquidations.emisionDate\n        ? moment(emisionDate).format(DATE_FORMATS.shortDate)\n        : \"\",\n    };\n  };\n\n  const initialValues = useMemo(() => {\n    return castDatePicker(props.invoiceDetail);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    props.invoiceDetail.id,\n    props.detailPreliquidations.status.tag,\n    props.isFetching,\n  ]);\n\n  const isFormEnabled = useMemo(() => {\n    const tag = props.detailPreliquidations.status.tag;\n    return [\"pending\", \"in_approvement\"].includes(tag);\n  }, [props.detailPreliquidations.status.tag]);\n\n  const validationSchema: yup.SchemaOf<invoiceValidationSchema> = yup.object({\n    emisionDate: yup\n      .string()\n      .test(\"requireDatePicker\", \"\", (value) => !!value)\n      .test(\"errorDatePicker\", \"error.input.emisionDate\", (value) =>\n        validarFechas(value)\n      ),\n    invoiceType: yup.object({\n      name: yup.string().required(\"global:error.input.required\"),\n    }),\n    salePoint: yup\n      .string()\n      .min(4, i18next.t(\"global:error.input.salePoint\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.salePoint\")\n      ),\n\n    invoiceNumber: yup\n      .string()\n      .min(8, i18next.t(\"global:error.input.invoiceNumber\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.invoiceNumber\")\n      ),\n\n    caeNumber: yup\n      .string()\n      .min(14, i18next.t(\"global:error.input.caeNumber\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.caeNumber\")\n      ),\n  });\n\n  return (\n    <Invoice\n      {...props}\n      fileHandler={fileHandler}\n      deleteFile={deleteFile}\n      downloadFile={downloadFile}\n      validationSchema={validationSchema}\n      initialValues={initialValues}\n      isFormEnabled={isFormEnabled}\n      presettementId={params.id}\n      handleClickBack={handleClickBack}\n      changePage={changePage}\n      goToPreviousFile={goToPreviousFile}\n    />\n  );\n};\n\nconst mapStateToProps = (state: RootState) => ({\n  isFetching: preliquidationSelector(state).fetching,\n  invoiceDetail: preliquidationSelector(state).invoiceDetail,\n  detailPreliquidations: preliquidationSelector(state).detailPreliquidations,\n  invoiceFileStatus: preliquidationSelector(state).invoiceFileStatus,\n  invoiceTypes: preliquidationSelector(state).invoiceTypes,\n  approvingInvoice: preliquidationSelector(state).approvingInvoice\n});\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => ({\n  setActualPage: (page:PagesPreliquidationTypes) => {\n    dispatch(preliActions.setActualPage(page));\n  },\n  getInvoiceDetail: (params: string | undefined) => {\n    dispatch(preliActions.getInvoiceDetailRequest(params));\n  },\n  getInvoiceDetailSave: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailSaveRequest(params));\n  },\n  getInvoiceDetailApprove: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailApproveFetch(params));\n  },\n  getInvoiceDetailDelete: (params: RejectInvoiceMiddlewareType) => {\n    dispatch(preliActions.getInvoiceDetailDeleteRequest(params));\n  },\n  uploadInvoiceFile: (params: UploadInvoiceFileMiddlewareType) => {\n    dispatch(preliActions.uploadInvoiceFile(params));\n  },\n  replaceInvoiceFile: (params: UploadInvoiceFileMiddlewareType) => {\n    dispatch(preliActions.replaceInvoiceFile(params));\n  },\n  deleteInvoiceFile: (id: number) => {\n    dispatch(preliActions.deleteInvoiceFileRequest({ id }));\n  },\n  getInvoiceDetailTypes: () => {\n    dispatch(preliActions.getInvoiceDetailTypesRequest());\n  },\n  resetInvoiceDetail: () => {\n    dispatch(preliActions.resetInvoiceDetail());\n  },\n  setDirty: (dirty: boolean) => {\n    dispatch(preliActions.setDirty(dirty));\n  },\n  showNotification: (content: NotificationStateType) => {\n    dispatch(notificationActions.showNotification(content));\n  },\n  setInvoiceFileStatus: (params: InvoiceFileStatus) => {\n    dispatch(preliActions.setInvoiceFileStatus(params));\n  },\n});\nexport default connect(mapStateToProps, mapDispatchToProps)(InvoiceContainer);\n"]},"metadata":{},"sourceType":"module"}