{"ast":null,"code":"var _jsxFileName = \"/home/nahuel/pickers-admin-front/src/pages/preliquidation/DetailPreliquidation/invoice/InvoiceContainer.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\nimport Invoice from \"./Invoice\";\nimport { actions as preliActions, preliquidationSelector } from \"reducers/preliquidation\";\nimport { actions as notificationActions } from \"reducers/notification\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport * as yup from \"yup\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { DATE_FORMATS, MAX_FILE_SIZE, VALIDATION_REGEX } from \"utils/constants\";\nimport { getBase64FromUrl, isBase64, toBase64 } from \"utils/toBase64\";\nimport { PagesPreliquidationTypes } from \"../types\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst InvoiceContainer = props => {\n  _s();\n\n  const params = useParams();\n  useEffect(() => {\n    props.setInvoiceFileStatus({\n      loading: false,\n      error: false\n    });\n    props.setActualPage(PagesPreliquidationTypes.INVOICE);\n    props.getInvoiceDetailTypes();\n    props.getInvoiceDetail(params.id);\n    return () => props.resetInvoiceDetail(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fileHandler = async file => {\n    props.setInvoiceFileStatus({\n      loading: true\n    });\n\n    if (file.size > MAX_FILE_SIZE || file.type !== \"application/pdf\") {\n      props.setInvoiceFileStatus({\n        error: true,\n        loading: false,\n        message: \"component:label.pdfController.invalidFile\"\n      });\n      return;\n    } else {\n      try {\n        var _props$invoiceDetail, _props$invoiceDetail$;\n\n        const base64 = await toBase64(file); // Si se esta reemplazando el archivo, fuerza a que\n        // se vuelvan a consumir los datos desde el back ya que el\n        // formulario con los datos de factura debe estar vacio.\n\n        const refresh = (_props$invoiceDetail = props.invoiceDetail) === null || _props$invoiceDetail === void 0 ? void 0 : (_props$invoiceDetail$ = _props$invoiceDetail.invoiceFile) === null || _props$invoiceDetail$ === void 0 ? void 0 : _props$invoiceDetail$.upload;\n        props.uploadInvoiceFile({\n          id: parseInt(params.id || \"0\"),\n          content: base64,\n          refreshPage: refresh\n        });\n      } catch (err) {\n        console.log(\"Base64 error: \", err);\n      }\n    }\n  };\n\n  const history = useHistory();\n\n  const handleClickBack = dirty => {\n    const onClose = () => history.goBack();\n\n    if (dirty) showDirtyNotification(onClose);else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);else onClose();\n  };\n\n  const showDirtyNotification = onClose => {\n    const html = document.documentElement;\n    const height = Math.max(html.clientHeight, html.scrollHeight);\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"pickers:title.modal.saveChanges\"),\n      body: i18next.t(\"pickers:label.modal.saveChanges\"),\n      onClickLabel: \"pickers:button.modal.goToSave\",\n      onCloseLabel: \"pickers:button.modal.notSave\",\n      onClose: onClose,\n      onClick: () => window.scroll({\n        top: height,\n        left: 0,\n        behavior: \"smooth\"\n      })\n    });\n  };\n\n  const showWrongFilesNotification = onClose => props.showNotification({\n    level: \"warning\",\n    title: i18next.t(\"global:title.modal.withoutSaving\"),\n    body: i18next.t(\"global:label.modal.withoutSaving\"),\n    onClickLabel: i18next.t(\"global:label.button.checkErrors\"),\n    onCloseLabel: i18next.t(\"global:label.button.continue\"),\n    onClose: onClose,\n    onClick: undefined\n  });\n\n  const changePage = (page, isDirty) => {\n    const onClose = () => {\n      props.setActualPage(page);\n      history.replace(`/preliquidation/${params.id}`);\n    };\n\n    if (isDirty) showDirtyNotification(onClose);else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);else onClose();\n  };\n\n  const deleteFile = () => {\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"invoice:title.modal.deleteInvoice\"),\n      body: i18next.t(\"invoice:label.modal.deleteInvoice\"),\n      onClickLabel: \"invoice:button.modal.delete\",\n      onCloseLabel: \"invoice:button.modal.cancel\",\n      onClose: undefined,\n      onClick: () => props.deleteInvoiceFile(parseInt(params.id || \"0\"))\n    });\n  };\n\n  const goToPreviousFile = () => {\n    props.setInvoiceFileStatus({\n      error: false,\n      loading: false\n    });\n  };\n\n  const downloadFile = async () => {\n    var _props$invoiceDetail2, _props$invoiceDetail3;\n\n    const url = (_props$invoiceDetail2 = props.invoiceDetail) === null || _props$invoiceDetail2 === void 0 ? void 0 : (_props$invoiceDetail3 = _props$invoiceDetail2.invoiceFile) === null || _props$invoiceDetail3 === void 0 ? void 0 : _props$invoiceDetail3.url;\n    if (!url) return;\n    const now = new Date();\n    const date = `${now.getDate()}_${now.getMonth() + 1}_${now.getFullYear()}`;\n    const time = `${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`;\n    const downloadLink = document.createElement(\"a\");\n    const fileName = `preli-${params.id || \"\"}-${date}_${time}.pdf`;\n\n    if (isBase64(url)) {\n      downloadLink.href = url;\n    } else {\n      const base64 = await getBase64FromUrl(url);\n      downloadLink.href = base64;\n    }\n\n    downloadLink.download = fileName;\n    downloadLink.click();\n  };\n\n  const validarFechas = value => {\n    var _props$detailPreliqui;\n\n    if (!value || typeof value === \"string\" || !(value !== null && value !== void 0 && value.from)) return true;\n    const valueProps = moment(value === null || value === void 0 ? void 0 : value.from, \"DD/MM/YYYY\");\n    const today = moment();\n    const startDate = moment((_props$detailPreliqui = props.detailPreliquidations) === null || _props$detailPreliqui === void 0 ? void 0 : _props$detailPreliqui.generatedAt);\n    const range = valueProps.isBetween(startDate, today, \"day\", \"[]\");\n    return range;\n  };\n\n  const castDatePicker = detailPreliquidations => {\n    var _detailPreliquidation, _detailPreliquidation2, _detailPreliquidation3;\n\n    return { ...detailPreliquidations,\n      caeNumber: (_detailPreliquidation = detailPreliquidations.caeNumber) !== null && _detailPreliquidation !== void 0 ? _detailPreliquidation : \"\",\n      invoiceNumber: (_detailPreliquidation2 = detailPreliquidations.invoiceNumber) !== null && _detailPreliquidation2 !== void 0 ? _detailPreliquidation2 : \"\",\n      salePoint: (_detailPreliquidation3 = detailPreliquidations.salePoint) !== null && _detailPreliquidation3 !== void 0 ? _detailPreliquidation3 : \"\",\n      emisionDate: detailPreliquidations.emisionDate ? {\n        from: moment(detailPreliquidations.emisionDate).format(DATE_FORMATS.shortDate)\n      } : \"\"\n    };\n  };\n\n  const initialValues = useMemo(() => {\n    return castDatePicker(props.invoiceDetail); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.invoiceDetail.id, props.detailPreliquidations.status.tag, props.isFetching]);\n  const validationSchema = yup.object({\n    emisionDate: yup.mixed().test(\"requireDatePicker\", \"\", value => !!value).test(\"errorDatePicker\", \"error.input.emisionDate\", value => validarFechas(value)),\n    invoiceType: yup.object({\n      name: yup.string().required(\"global:error.input.required\")\n    }),\n    salePoint: yup.string().min(4, i18next.t(\"global:error.input.salePoint\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.salePoint\")),\n    invoiceNumber: yup.string().min(8, i18next.t(\"global:error.input.invoiceNumber\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.invoiceNumber\")),\n    caeNumber: yup.string().min(14, i18next.t(\"global:error.input.caeNumber\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.caeNumber\"))\n  });\n  return /*#__PURE__*/_jsxDEV(Invoice, { ...props,\n    fileHandler: fileHandler,\n    deleteFile: deleteFile,\n    downloadFile: downloadFile,\n    validationSchema: validationSchema,\n    initialValues: initialValues,\n    presettementId: params.id,\n    handleClickBack: handleClickBack,\n    changePage: changePage,\n    goToPreviousFile: goToPreviousFile\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 242,\n    columnNumber: 5\n  }, this);\n};\n\n_s(InvoiceContainer, \"Q7Z9O4kLlVRtmz2JX/zVSW1tYdc=\", false, function () {\n  return [useParams, useHistory];\n});\n\n_c = InvoiceContainer;\n\nconst mapStateToProps = state => ({\n  isFetching: preliquidationSelector(state).fetching,\n  invoiceDetail: preliquidationSelector(state).invoiceDetail,\n  detailPreliquidations: preliquidationSelector(state).detailPreliquidations,\n  invoiceFileStatus: preliquidationSelector(state).invoiceFileStatus,\n  invoiceTypes: preliquidationSelector(state).invoiceTypes\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setActualPage: page => {\n    dispatch(preliActions.setActualPage(page));\n  },\n  getInvoiceDetail: params => {\n    dispatch(preliActions.getInvoiceDetailRequest(params));\n  },\n  getInvoiceDetailSave: params => {\n    dispatch(preliActions.getInvoiceDetailSaveRequest(params));\n  },\n  getInvoiceDetailApprove: params => {\n    dispatch(preliActions.getInvoiceDetailApproveRequest(params));\n  },\n  getInvoiceDetailDelete: params => {\n    dispatch(preliActions.getInvoiceDetailDeleteRequest(params));\n  },\n  uploadInvoiceFile: params => {\n    dispatch(preliActions.uploadInvoiceFile(params));\n  },\n  deleteInvoiceFile: id => {\n    dispatch(preliActions.deleteInvoiceFileRequest({\n      id\n    }));\n  },\n  getInvoiceDetailTypes: () => {\n    dispatch(preliActions.getInvoiceDetailTypesRequest());\n  },\n  resetInvoiceDetail: () => {\n    dispatch(preliActions.resetInvoiceDetail());\n  },\n  setDirty: dirty => {\n    dispatch(preliActions.setDirty(dirty));\n  },\n  showNotification: content => {\n    dispatch(notificationActions.showNotification(content));\n  },\n  setInvoiceFileStatus: params => {\n    dispatch(preliActions.setInvoiceFileStatus(params));\n  }\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InvoiceContainer);\n\nvar _c;\n\n$RefreshReg$(_c, \"InvoiceContainer\");","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/pages/preliquidation/DetailPreliquidation/invoice/InvoiceContainer.tsx"],"names":["useEffect","useMemo","connect","Invoice","actions","preliActions","preliquidationSelector","notificationActions","useHistory","useParams","yup","i18next","moment","DATE_FORMATS","MAX_FILE_SIZE","VALIDATION_REGEX","getBase64FromUrl","isBase64","toBase64","PagesPreliquidationTypes","InvoiceContainer","props","params","setInvoiceFileStatus","loading","error","setActualPage","INVOICE","getInvoiceDetailTypes","getInvoiceDetail","id","resetInvoiceDetail","fileHandler","file","size","type","message","base64","refresh","invoiceDetail","invoiceFile","upload","uploadInvoiceFile","parseInt","content","refreshPage","err","console","log","history","handleClickBack","dirty","onClose","goBack","showDirtyNotification","invoiceFileStatus","showWrongFilesNotification","html","document","documentElement","height","Math","max","clientHeight","scrollHeight","showNotification","level","title","t","body","onClickLabel","onCloseLabel","onClick","window","scroll","top","left","behavior","undefined","changePage","page","isDirty","replace","deleteFile","deleteInvoiceFile","goToPreviousFile","downloadFile","url","now","Date","date","getDate","getMonth","getFullYear","time","getHours","getMinutes","getSeconds","downloadLink","createElement","fileName","href","download","click","validarFechas","value","from","valueProps","today","startDate","detailPreliquidations","generatedAt","range","isBetween","castDatePicker","caeNumber","invoiceNumber","salePoint","emisionDate","format","shortDate","initialValues","status","tag","isFetching","validationSchema","object","mixed","test","invoiceType","name","string","required","min","matches","regNumber","mapStateToProps","state","fetching","invoiceTypes","mapDispatchToProps","dispatch","getInvoiceDetailRequest","getInvoiceDetailSave","getInvoiceDetailSaveRequest","getInvoiceDetailApprove","getInvoiceDetailApproveRequest","getInvoiceDetailDelete","getInvoiceDetailDeleteRequest","deleteInvoiceFileRequest","getInvoiceDetailTypesRequest","setDirty"],"mappings":"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","sourcesContent":["import { useEffect, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { AppDispatch, RootState } from \"store\";\nimport Invoice from \"./Invoice\";\nimport {\n  actions as preliActions,\n  preliquidationSelector,\n} from \"reducers/preliquidation\";\nimport { actions as notificationActions } from \"reducers/notification\";\nimport {\n  DatePickerType,\n  detailPreliquidationDatePicker,\n  detailPreliquidationInvoiceContainerPropsType,\n  invoiceValidationSchema,\n} from \"./types\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport {\n  RejectInvoiceMiddlewareType,\n  UploadInvoiceFileMiddlewareType,\n} from \"sagas/types/preliquidation\";\nimport * as yup from \"yup\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { DATE_FORMATS, MAX_FILE_SIZE, VALIDATION_REGEX } from \"utils/constants\";\nimport { getBase64FromUrl, isBase64, toBase64 } from \"utils/toBase64\";\nimport {\n  InvoiceFileStatus,\n  DetailInvoiceType,\n} from \"reducers/types/preliquidation\";\nimport { NotificationStateType } from \"reducers/types/notification\";\nimport { PagesPreliquidationTypes } from \"../types\";\n\nconst InvoiceContainer = (\n  props: detailPreliquidationInvoiceContainerPropsType\n): JSX.Element => {\n  const params: { id?: string } = useParams();\n\n  useEffect(() => {\n    props.setInvoiceFileStatus({ loading: false, error: false });\n    props.setActualPage(PagesPreliquidationTypes.INVOICE);\n    props.getInvoiceDetailTypes();\n    props.getInvoiceDetail(params.id);\n\n    return () => props.resetInvoiceDetail();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fileHandler = async (file: File) => {\n    props.setInvoiceFileStatus({ loading: true });\n\n    if (file.size > MAX_FILE_SIZE || file.type !== \"application/pdf\") {\n      props.setInvoiceFileStatus({\n        error: true,\n        loading: false,\n        message: \"component:label.pdfController.invalidFile\",\n      });\n      return;\n    } else {\n      try {\n        const base64 = (await toBase64(file)) as string;\n\n        // Si se esta reemplazando el archivo, fuerza a que\n        // se vuelvan a consumir los datos desde el back ya que el\n        // formulario con los datos de factura debe estar vacio.\n        const refresh = props.invoiceDetail?.invoiceFile?.upload;\n        props.uploadInvoiceFile({\n          id: parseInt(params.id || \"0\"),\n          content: base64,\n          refreshPage: refresh\n        });\n      } catch (err) {\n        console.log(\"Base64 error: \", err);\n      }\n    }\n  };\n  const history = useHistory();\n  const handleClickBack = (dirty: boolean) => {\n    const onClose = () => history.goBack();\n\n    if (dirty) showDirtyNotification(onClose);\n    else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);\n    else onClose();\n  };\n\n  const showDirtyNotification = (onClose: Function) => {\n    const html = document.documentElement;\n    const height = Math.max(html.clientHeight, html.scrollHeight);\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"pickers:title.modal.saveChanges\"),\n      body: i18next.t(\"pickers:label.modal.saveChanges\"),\n      onClickLabel: \"pickers:button.modal.goToSave\",\n      onCloseLabel: \"pickers:button.modal.notSave\",\n      onClose: onClose,\n      onClick: () =>\n        window.scroll({\n          top: height,\n          left: 0,\n          behavior: \"smooth\",\n        }),\n    });\n  };\n\n  const showWrongFilesNotification = (onClose: Function) =>\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"global:title.modal.withoutSaving\"),\n      body: i18next.t(\"global:label.modal.withoutSaving\"),\n      onClickLabel: i18next.t(\"global:label.button.checkErrors\"),\n      onCloseLabel: i18next.t(\"global:label.button.continue\"),\n      onClose: onClose,\n      onClick: undefined,\n    });\n\n  const changePage = (page: PagesPreliquidationTypes, isDirty: boolean) => {\n    const onClose = () => {\n      props.setActualPage(page);\n\n      history.replace(`/preliquidation/${params.id}`);\n    };\n    if (isDirty) showDirtyNotification(onClose);\n    else if (props.invoiceFileStatus.error) showWrongFilesNotification(onClose);\n    else onClose();\n  };\n\n  const deleteFile = () => {\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"invoice:title.modal.deleteInvoice\"),\n      body: i18next.t(\"invoice:label.modal.deleteInvoice\"),\n      onClickLabel: \"invoice:button.modal.delete\",\n      onCloseLabel: \"invoice:button.modal.cancel\",\n      onClose: undefined,\n      onClick: () => props.deleteInvoiceFile(parseInt(params.id || \"0\")),\n    });\n  };\n\n  const goToPreviousFile = () => {\n    props.setInvoiceFileStatus({\n      error: false,\n      loading: false,\n    });\n  };\n\n  const downloadFile = async () => {\n    const url = props.invoiceDetail?.invoiceFile?.url;\n    if (!url) return;\n\n    const now = new Date();\n    const date = `${now.getDate()}_${now.getMonth() + 1}_${now.getFullYear()}`;\n    const time = `${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`;\n    const downloadLink = document.createElement(\"a\");\n    const fileName = `preli-${params.id || \"\"}-${date}_${time}.pdf`;\n\n    if (isBase64(url)) {\n      downloadLink.href = url;\n    } else {\n      const base64 = (await getBase64FromUrl(url)) as string;\n      downloadLink.href = base64;\n    }\n    downloadLink.download = fileName;\n    downloadLink.click();\n  };\n\n  const validarFechas = (value: DatePickerType | string | undefined) => {\n    if (!value || typeof value === \"string\" || !value?.from) return true;\n\n    const valueProps = moment(value?.from, \"DD/MM/YYYY\");\n    const today = moment();\n    const startDate = moment(props.detailPreliquidations?.generatedAt);\n\n    const range = valueProps.isBetween(startDate, today, \"day\", \"[]\");\n\n    return range;\n  };\n\n  const castDatePicker = (detailPreliquidations: DetailInvoiceType) => {\n    return {\n      ...detailPreliquidations,\n      caeNumber: detailPreliquidations.caeNumber ?? \"\",\n      invoiceNumber: detailPreliquidations.invoiceNumber ?? \"\",\n      salePoint: detailPreliquidations.salePoint ?? \"\",\n      emisionDate: detailPreliquidations.emisionDate\n        ? {\n            from: moment(detailPreliquidations.emisionDate).format(\n              DATE_FORMATS.shortDate\n            ),\n          }\n        : \"\",\n    };\n  };\n\n  const initialValues = useMemo(() => {\n    return castDatePicker(props.invoiceDetail);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    props.invoiceDetail.id,\n    props.detailPreliquidations.status.tag,\n    props.isFetching\n  ]);\n\n  const validationSchema: yup.SchemaOf<invoiceValidationSchema> = yup.object({\n    emisionDate: yup\n      .mixed<DatePickerType | string>()\n      .test(\"requireDatePicker\", \"\", (value) => !!value)\n      .test(\"errorDatePicker\", \"error.input.emisionDate\", (value) =>\n        validarFechas(value)\n      ),\n    invoiceType: yup.object({\n      name: yup.string().required(\"global:error.input.required\"),\n    }),\n    salePoint: yup\n      .string()\n      .min(4, i18next.t(\"global:error.input.salePoint\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.salePoint\")\n      ),\n\n    invoiceNumber: yup\n      .string()\n      .min(8, i18next.t(\"global:error.input.invoiceNumber\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.invoiceNumber\")\n      ),\n\n    caeNumber: yup\n      .string()\n      .min(14, i18next.t(\"global:error.input.caeNumber\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.caeNumber\")\n      ),\n  });\n\n  return (\n    <Invoice\n      {...props}\n      fileHandler={fileHandler}\n      deleteFile={deleteFile}\n      downloadFile={downloadFile}\n      validationSchema={validationSchema}\n      initialValues={initialValues}\n      presettementId={params.id}\n      handleClickBack={handleClickBack}\n      changePage={changePage}\n      goToPreviousFile={goToPreviousFile}\n    />\n  );\n};\n\nconst mapStateToProps = (state: RootState) => ({\n  isFetching: preliquidationSelector(state).fetching,\n  invoiceDetail: preliquidationSelector(state).invoiceDetail,\n  detailPreliquidations: preliquidationSelector(state).detailPreliquidations,\n  invoiceFileStatus: preliquidationSelector(state).invoiceFileStatus,\n  invoiceTypes: preliquidationSelector(state).invoiceTypes,\n});\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => ({\n  setActualPage: (page:PagesPreliquidationTypes) => {\n    dispatch(preliActions.setActualPage(page));\n  },\n  getInvoiceDetail: (params: string | undefined) => {\n    dispatch(preliActions.getInvoiceDetailRequest(params));\n  },\n  getInvoiceDetailSave: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailSaveRequest(params));\n  },\n  getInvoiceDetailApprove: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailApproveRequest(params));\n  },\n  getInvoiceDetailDelete: (params: RejectInvoiceMiddlewareType) => {\n    dispatch(preliActions.getInvoiceDetailDeleteRequest(params));\n  },\n  uploadInvoiceFile: (params: UploadInvoiceFileMiddlewareType) => {\n    dispatch(preliActions.uploadInvoiceFile(params));\n  },\n  deleteInvoiceFile: (id: number) => {\n    dispatch(preliActions.deleteInvoiceFileRequest({ id }));\n  },\n  getInvoiceDetailTypes: () => {\n    dispatch(preliActions.getInvoiceDetailTypesRequest());\n  },\n  resetInvoiceDetail: () => {\n    dispatch(preliActions.resetInvoiceDetail());\n  },\n  setDirty: (dirty: boolean) => {\n    dispatch(preliActions.setDirty(dirty));\n  },\n  showNotification: (content: NotificationStateType) => {\n    dispatch(notificationActions.showNotification(content));\n  },\n  setInvoiceFileStatus: (params: InvoiceFileStatus) => {\n    dispatch(preliActions.setInvoiceFileStatus(params));\n  },\n});\nexport default connect(mapStateToProps, mapDispatchToProps)(InvoiceContainer);\n"]},"metadata":{},"sourceType":"module"}