{"ast":null,"code":"import moment from \"moment\";\nimport { call, put, delay, takeLatest, all } from \"redux-saga/effects\";\nimport { DATE_FORMATS, FIRST_ANIMATION_TIME } from \"utils/constants\";\nimport * as preliquidationsMiddleware from \"../middleware/preliquidations\";\nimport { actions as notificationActions } from \"../reducers/notification\";\nimport { actions as preliquidationActions } from \"../reducers/preliquidation\";\nimport i18next from \"i18next\";\nimport { replace } from \"connected-react-router\";\nconst sagas = [takeLatest(preliquidationActions.getPreliquidationsRequest.type, getPreliquidations), takeLatest(preliquidationActions.getDetailPreliquidationsRequest.type, getDetailPreliquidations), takeLatest(preliquidationActions.getMorePreliquidationsRequest.type, getMorePreliquidations), takeLatest(preliquidationActions.getInvoiceDetailRequest.type, getInvoiceDetail), takeLatest(preliquidationActions.getInvoiceDetailSaveRequest.type, putSaveDetailInvoice), takeLatest(preliquidationActions.getInvoiceDetailApproveRequest.type, patchApproveDetailInvoice), takeLatest(preliquidationActions.getInvoiceDetailDeleteRequest.type, putDeleteDetailInvoice), takeLatest(preliquidationActions.replaceInvoiceFile.type, replaceInvoiceFile), takeLatest(preliquidationActions.uploadInvoiceFile.type, uploadInvoiceFile), takeLatest(preliquidationActions.deleteInvoiceFileRequest.type, deleteInvoiceFile), takeLatest(preliquidationActions.getInvoiceDetailTypesRequest.type, getDetailInvoiceTypes), takeLatest(preliquidationActions.adjustAmount.type, adjustAmount)];\nexport default sagas;\n\nconst process = body => {\n  return { ...body,\n    emisionDate: body !== null && body !== void 0 && body.emisionDate ? moment(body === null || body === void 0 ? void 0 : body.emisionDate, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate) : null\n  };\n};\n\nconst processDatePicker = payload => {\n  let payloadCast = payload;\n  const {\n    generatedAt\n  } = payload;\n  if (!generatedAt) delete payloadCast.generatedAt;else {\n    payloadCast = { ...payload,\n      generatedAt: moment(generatedAt, DATE_FORMATS.shortDate).format(DATE_FORMATS.shortISODate)\n    };\n  }\n  return payloadCast;\n};\n\nfunction* getPreliquidations(_ref) {\n  let {\n    payload\n  } = _ref;\n\n  if ((payload === null || payload === void 0 ? void 0 : payload.status) === \"\") {\n    delete payload[\"status\"];\n  }\n\n  let payloadCast = processDatePicker(payload);\n  const response = yield call(preliquidationsMiddleware.getPreliquidations, payloadCast);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getPreliquidationsError());\n  } else {\n    yield put(preliquidationActions.getPreliquidationsSuccess(response.data));\n  }\n}\n\nfunction* getDetailPreliquidations(_ref2) {\n  let {\n    payload\n  } = _ref2;\n  const response = yield call(preliquidationsMiddleware.getDetailPreliquidations, payload);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getDetailPreliquidationsError());\n  } else {\n    const {\n      result\n    } = response.data;\n    yield put(preliquidationActions.getDetailPreliquidationsSuccess(result));\n  }\n}\n\nfunction* getMorePreliquidations(_ref3) {\n  let {\n    payload\n  } = _ref3;\n  let payloadCast = processDatePicker(payload);\n  const response = yield call(preliquidationsMiddleware.getPreliquidations, payloadCast);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getMorePreliquidationsError());\n  } else {\n    const {\n      result: {\n        items\n      },\n      ...rest\n    } = response.data;\n    yield put(preliquidationActions.getMorePreliquidationsSuccess({\n      items,\n      ...rest\n    }));\n  }\n}\n\nfunction* getInvoiceDetail(_ref4) {\n  let {\n    payload\n  } = _ref4;\n  const response = yield call(preliquidationsMiddleware.getDetailInvoice, payload);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailError());\n  } else {\n    const {\n      result\n    } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailSuccess(result));\n  }\n}\n\nfunction* putSaveDetailInvoice(_ref5) {\n  var _payload$invoiceType;\n\n  let {\n    payload\n  } = _ref5;\n  let result = {\n    emisionDate: payload.emisionDate || null,\n    invoiceType: (_payload$invoiceType = payload.invoiceType) !== null && _payload$invoiceType !== void 0 && _payload$invoiceType.tag ? payload.invoiceType : null,\n    invoiceNumber: payload.invoiceNumber || null,\n    salePoint: payload.salePoint || null,\n    caeNumber: payload.caeNumber || null\n  };\n  result = process(result);\n  const response = yield call(preliquidationsMiddleware.putSaveDetailInvoice, payload.presettementId, result);\n\n  if (response.status !== 200) {\n    yield put(notificationActions.showNotification({\n      level: \"error\",\n      title: i18next.t(\"global:title.modal.connectionError\"),\n      body: i18next.t(\"global:label.modal.connectionError\")\n    }));\n    yield put(preliquidationActions.getInvoiceDetailSaveError());\n  } else {\n    yield put(replace(\"/presettlements\"));\n    yield put(preliquidationActions.getInvoiceDetailSaveSuccess());\n  }\n}\n\nfunction* patchApproveDetailInvoice(_ref6) {\n  let {\n    payload\n  } = _ref6;\n  let result = {\n    emisionDate: payload.emisionDate || \"\",\n    invoiceType: payload.invoiceType,\n    invoiceNumber: payload.invoiceNumber,\n    salePoint: payload.salePoint,\n    caeNumber: payload.caeNumber\n  };\n  result = process(result);\n  const response = yield call(preliquidationsMiddleware.patchApproveDetailInvoice, payload.presettementId, result);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailApproveError());\n    yield put(notificationActions.showNotification({\n      level: \"error\",\n      title: i18next.t(\"global:title.modal.connectionError\"),\n      body: i18next.t(\"global:label.modal.connectionError\")\n    }));\n  } else {\n    yield put(replace(\"/presettlements\"));\n  }\n}\n\nfunction* putDeleteDetailInvoice(_ref7) {\n  let {\n    payload\n  } = _ref7;\n  const response = yield call(preliquidationsMiddleware.putDeleteDetailInvoice, payload.presettlementId);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailDeleteError());\n  } else {\n    yield put(replace(\"/presettlements\"));\n    yield put(preliquidationActions.getInvoiceDetailDeleteSuccess());\n  }\n}\n\nfunction* replaceInvoiceFile(_ref8) {\n  let {\n    payload\n  } = _ref8;\n  const response = yield call(preliquidationsMiddleware.replaceInvoiceFile, payload);\n\n  if (response.status !== 200 && response.status !== 201) {\n    yield put(preliquidationActions.replaceInvoiceFileError());\n  } else {\n    yield put(preliquidationActions.getInvoiceDetailRequest(payload.id.toString()));\n    yield put(preliquidationActions.setInvoiceFileStatus({\n      loading: false\n    }));\n  }\n}\n\nfunction* uploadInvoiceFile(_ref9) {\n  let {\n    payload\n  } = _ref9;\n  const response = yield call(preliquidationsMiddleware.uploadInvoiceFile, payload);\n\n  if (response.status !== 200 && response.status !== 201) {\n    yield put(preliquidationActions.uploadInvoiceFileError());\n  } else {\n    yield put(preliquidationActions.uploadInvoiceFileSuccess(payload.content));\n    yield put(preliquidationActions.setInvoiceFileStatus({\n      loading: false\n    }));\n  }\n}\n\nfunction* deleteInvoiceFile(_ref10) {\n  let {\n    payload\n  } = _ref10;\n  const response = yield call(preliquidationsMiddleware.deleteInvoiceFile, payload.id);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.deleteInvoiceFileError());\n  } else {\n    yield put(preliquidationActions.getInvoiceDetailRequest(payload.id.toString()));\n  }\n}\n\nfunction* getDetailInvoiceTypes() {\n  const response = yield call(preliquidationsMiddleware.getDetailInvoiceTypes);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailTypesError());\n  } else {\n    const {\n      result\n    } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailTypesSuccess(result));\n  }\n}\n\nfunction* adjustAmount(_ref11) {\n  let {\n    payload\n  } = _ref11;\n  const [response] = yield all([call(preliquidationsMiddleware.preliquidationAdjustment, payload), delay(FIRST_ANIMATION_TIME)]);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.adjustAmountError());\n\n    if (response.data.statusCode === 30020) {\n      yield delay(2500);\n      yield put(preliquidationActions.toggleModalVisibility(false));\n      yield put(notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"detailPreliquidation:title.modal.concurrency\"),\n        body: i18next.t(\"detailPreliquidation:body.modal.concurrency\"),\n        onClick: () => payload.callback(payload.id)\n      }));\n    }\n  } else {\n    yield put(preliquidationActions.adjustAmountSuccess());\n  }\n}","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/sagas/preliquidation.ts"],"names":["moment","call","put","delay","takeLatest","all","DATE_FORMATS","FIRST_ANIMATION_TIME","preliquidationsMiddleware","actions","notificationActions","preliquidationActions","i18next","replace","sagas","getPreliquidationsRequest","type","getPreliquidations","getDetailPreliquidationsRequest","getDetailPreliquidations","getMorePreliquidationsRequest","getMorePreliquidations","getInvoiceDetailRequest","getInvoiceDetail","getInvoiceDetailSaveRequest","putSaveDetailInvoice","getInvoiceDetailApproveRequest","patchApproveDetailInvoice","getInvoiceDetailDeleteRequest","putDeleteDetailInvoice","replaceInvoiceFile","uploadInvoiceFile","deleteInvoiceFileRequest","deleteInvoiceFile","getInvoiceDetailTypesRequest","getDetailInvoiceTypes","adjustAmount","process","body","emisionDate","shortDate","format","shortISODate","processDatePicker","payload","payloadCast","generatedAt","status","response","getPreliquidationsError","getPreliquidationsSuccess","data","getDetailPreliquidationsError","result","getDetailPreliquidationsSuccess","getMorePreliquidationsError","items","rest","getMorePreliquidationsSuccess","getDetailInvoice","getInvoiceDetailError","getInvoiceDetailSuccess","invoiceType","tag","invoiceNumber","salePoint","caeNumber","presettementId","showNotification","level","title","t","getInvoiceDetailSaveError","getInvoiceDetailSaveSuccess","getInvoiceDetailApproveError","presettlementId","getInvoiceDetailDeleteError","getInvoiceDetailDeleteSuccess","replaceInvoiceFileError","id","toString","setInvoiceFileStatus","loading","uploadInvoiceFileError","uploadInvoiceFileSuccess","content","deleteInvoiceFileError","getInvoiceDetailTypesError","getInvoiceDetailTypesSuccess","preliquidationAdjustment","adjustAmountError","statusCode","toggleModalVisibility","onClick","callback","adjustAmountSuccess"],"mappings":"AAEA,OAAOA,MAAP,MAAmB,QAAnB;AAIA,SACEC,IADF,EAGEC,GAHF,EAIEC,KAJF,EAMEC,UANF,EAOEC,GAPF,QASO,oBATP;AAUA,SAASC,YAAT,EAAuBC,oBAAvB,QAAmD,iBAAnD;AACA,OAAO,KAAKC,yBAAZ,MAA2C,+BAA3C;AACA,SAASC,OAAO,IAAIC,mBAApB,QAA+C,0BAA/C;AACA,SAASD,OAAO,IAAIE,qBAApB,QAAiD,4BAAjD;AAgBA,OAAOC,OAAP,MAAoB,SAApB;AAEA,SAASC,OAAT,QAAwB,wBAAxB;AAEA,MAAMC,KAAK,GAAG,CACZV,UAAU,CACRO,qBAAqB,CAACI,yBAAtB,CAAgDC,IADxC,EAERC,kBAFQ,CADE,EAKZb,UAAU,CACRO,qBAAqB,CAACO,+BAAtB,CAAsDF,IAD9C,EAERG,wBAFQ,CALE,EASZf,UAAU,CACRO,qBAAqB,CAACS,6BAAtB,CAAoDJ,IAD5C,EAERK,sBAFQ,CATE,EAaZjB,UAAU,CACRO,qBAAqB,CAACW,uBAAtB,CAA8CN,IADtC,EAERO,gBAFQ,CAbE,EAiBZnB,UAAU,CACRO,qBAAqB,CAACa,2BAAtB,CAAkDR,IAD1C,EAERS,oBAFQ,CAjBE,EAqBZrB,UAAU,CACRO,qBAAqB,CAACe,8BAAtB,CAAqDV,IAD7C,EAERW,yBAFQ,CArBE,EAyBZvB,UAAU,CACRO,qBAAqB,CAACiB,6BAAtB,CAAoDZ,IAD5C,EAERa,sBAFQ,CAzBE,EA6BZzB,UAAU,CAACO,qBAAqB,CAACmB,kBAAtB,CAAyCd,IAA1C,EAAgDc,kBAAhD,CA7BE,EA8BZ1B,UAAU,CAACO,qBAAqB,CAACoB,iBAAtB,CAAwCf,IAAzC,EAA+Ce,iBAA/C,CA9BE,EA+BZ3B,UAAU,CACRO,qBAAqB,CAACqB,wBAAtB,CAA+ChB,IADvC,EAERiB,iBAFQ,CA/BE,EAmCZ7B,UAAU,CACRO,qBAAqB,CAACuB,4BAAtB,CAAmDlB,IAD3C,EAERmB,qBAFQ,CAnCE,EAuCZ/B,UAAU,CAACO,qBAAqB,CAACyB,YAAtB,CAAmCpB,IAApC,EAA0CoB,YAA1C,CAvCE,CAAd;AA0CA,eAAetB,KAAf;;AAEA,MAAMuB,OAAO,GAAIC,IAAD,IAA8C;AAC5D,SAAO,EACL,GAAGA,IADE;AAELC,IAAAA,WAAW,EAAED,IAAI,SAAJ,IAAAA,IAAI,WAAJ,IAAAA,IAAI,CAAEC,WAAN,GACTvC,MAAM,CAACsC,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEC,WAAP,EAAoBjC,YAAY,CAACkC,SAAjC,CAAN,CAAkDC,MAAlD,CACEnC,YAAY,CAACoC,YADf,CADS,GAIT;AANC,GAAP;AAQD,CATD;;AAWA,MAAMC,iBAAiB,GACrBC,OADwB,IAEmB;AAC3C,MAAIC,WAAmD,GACrDD,OADF;AAGA,QAAM;AAAEE,IAAAA;AAAF,MAAkBF,OAAxB;AACA,MAAI,CAACE,WAAL,EAAkB,OAAOD,WAAW,CAACC,WAAnB,CAAlB,KACK;AACHD,IAAAA,WAAW,GAAG,EACZ,GAAGD,OADS;AAEZE,MAAAA,WAAW,EAAE9C,MAAM,CAAC8C,WAAD,EAAcxC,YAAY,CAACkC,SAA3B,CAAN,CAA4CC,MAA5C,CACXnC,YAAY,CAACoC,YADF;AAFD,KAAd;AAMD;AAED,SAAOG,WAAP;AACD,CAlBD;;AAoBA,UAAU5B,kBAAV,OAOE;AAAA,MAP2B;AAC3B2B,IAAAA;AAD2B,GAO3B;;AACA,MAAI,CAAAA,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEG,MAAT,MAAoB,EAAxB,EAA4B;AAC1B,WAAOH,OAAO,CAAC,QAAD,CAAd;AACD;;AACD,MAAIC,WAAmD,GACrDF,iBAAiB,CAACC,OAAD,CADnB;AAGA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACS,kBADD,EAEzB4B,WAFyB,CAA3B;;AAIA,MAAIG,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAACsC,uBAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM/C,GAAG,CAACS,qBAAqB,CAACuC,yBAAtB,CAAgDF,QAAQ,CAACG,IAAzD,CAAD,CAAT;AACD;AACF;;AAED,UAAUhC,wBAAV,QAOE;AAAA,MAPiC;AACjCyB,IAAAA;AADiC,GAOjC;AACA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACW,wBADD,EAEzByB,OAFyB,CAA3B;;AAIA,MAAII,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAACyC,6BAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AAAEC,MAAAA;AAAF,QAAaL,QAAQ,CAACG,IAA5B;AACA,UAAMjD,GAAG,CAACS,qBAAqB,CAAC2C,+BAAtB,CAAsDD,MAAtD,CAAD,CAAT;AACD;AACF;;AAED,UAAUhC,sBAAV,QAOE;AAAA,MAP+B;AAC/BuB,IAAAA;AAD+B,GAO/B;AACA,MAAIC,WAAmD,GACrDF,iBAAiB,CAACC,OAAD,CADnB;AAEA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACS,kBADD,EAEzB4B,WAFyB,CAA3B;;AAIA,MAAIG,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAAC4C,2BAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AACJF,MAAAA,MAAM,EAAE;AAAEG,QAAAA;AAAF,OADJ;AAEJ,SAAGC;AAFC,QAGFT,QAAQ,CAACG,IAHb;AAIA,UAAMjD,GAAG,CACPS,qBAAqB,CAAC+C,6BAAtB,CAAoD;AAAEF,MAAAA,KAAF;AAAS,SAAGC;AAAZ,KAApD,CADO,CAAT;AAGD;AACF;;AAED,UAAUlC,gBAAV,QAWE;AAAA,MAXyB;AACzBqB,IAAAA;AADyB,GAWzB;AACA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACmD,gBADD,EAEzBf,OAFyB,CAA3B;;AAIA,MAAII,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAACiD,qBAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AAAEP,MAAAA;AAAF,QAAaL,QAAQ,CAACG,IAA5B;AACA,UAAMjD,GAAG,CAACS,qBAAqB,CAACkD,uBAAtB,CAA8CR,MAA9C,CAAD,CAAT;AACD;AACF;;AAED,UAAU5B,oBAAV,QASE;AAAA;;AAAA,MAT6B;AAC7BmB,IAAAA;AAD6B,GAS7B;AACA,MAAIS,MAA0C,GAAG;AAC/Cd,IAAAA,WAAW,EAAEK,OAAO,CAACL,WAAR,IAAuB,IADW;AAE/CuB,IAAAA,WAAW,EAAE,wBAAAlB,OAAO,CAACkB,WAAR,sEAAqBC,GAArB,GAA2BnB,OAAO,CAACkB,WAAnC,GAAiD,IAFf;AAG/CE,IAAAA,aAAa,EAAEpB,OAAO,CAACoB,aAAR,IAAyB,IAHO;AAI/CC,IAAAA,SAAS,EAAErB,OAAO,CAACqB,SAAR,IAAqB,IAJe;AAK/CC,IAAAA,SAAS,EAAEtB,OAAO,CAACsB,SAAR,IAAqB;AALe,GAAjD;AAOAb,EAAAA,MAAM,GAAGhB,OAAO,CAACgB,MAAD,CAAhB;AAEA,QAAML,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACiB,oBADD,EAEzBmB,OAAO,CAACuB,cAFiB,EAGzBd,MAHyB,CAA3B;;AAKA,MAAIL,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CACPQ,mBAAmB,CAAC0D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,OAD4B;AAEnCC,MAAAA,KAAK,EAAE1D,OAAO,CAAC2D,CAAR,CAAU,oCAAV,CAF4B;AAGnCjC,MAAAA,IAAI,EAAE1B,OAAO,CAAC2D,CAAR,CAAU,oCAAV;AAH6B,KAArC,CADO,CAAT;AAOA,UAAMrE,GAAG,CAACS,qBAAqB,CAAC6D,yBAAtB,EAAD,CAAT;AACD,GATD,MASO;AACL,UAAMtE,GAAG,CAACW,OAAO,CAAC,iBAAD,CAAR,CAAT;AACA,UAAMX,GAAG,CAACS,qBAAqB,CAAC8D,2BAAtB,EAAD,CAAT;AACD;AACF;;AAED,UAAU9C,yBAAV,QASE;AAAA,MATkC;AAClCiB,IAAAA;AADkC,GASlC;AACA,MAAIS,MAA0C,GAAG;AAC/Cd,IAAAA,WAAW,EAAEK,OAAO,CAACL,WAAR,IAAuB,EADW;AAE/CuB,IAAAA,WAAW,EAAElB,OAAO,CAACkB,WAF0B;AAG/CE,IAAAA,aAAa,EAAEpB,OAAO,CAACoB,aAHwB;AAI/CC,IAAAA,SAAS,EAAErB,OAAO,CAACqB,SAJ4B;AAK/CC,IAAAA,SAAS,EAAEtB,OAAO,CAACsB;AAL4B,GAAjD;AAOAb,EAAAA,MAAM,GAAGhB,OAAO,CAACgB,MAAD,CAAhB;AAEA,QAAML,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACmB,yBADD,EAEzBiB,OAAO,CAACuB,cAFiB,EAGzBd,MAHyB,CAA3B;;AAKA,MAAIL,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAAC+D,4BAAtB,EAAD,CAAT;AACA,UAAMxE,GAAG,CACPQ,mBAAmB,CAAC0D,gBAApB,CAAqC;AACnCC,MAAAA,KAAK,EAAE,OAD4B;AAEnCC,MAAAA,KAAK,EAAE1D,OAAO,CAAC2D,CAAR,CAAU,oCAAV,CAF4B;AAGnCjC,MAAAA,IAAI,EAAE1B,OAAO,CAAC2D,CAAR,CAAU,oCAAV;AAH6B,KAArC,CADO,CAAT;AAOD,GATD,MASO;AACL,UAAMrE,GAAG,CAACW,OAAO,CAAC,iBAAD,CAAR,CAAT;AACD;AACF;;AAED,UAAUgB,sBAAV,QASE;AAAA,MAT+B;AAC/Be,IAAAA;AAD+B,GAS/B;AACA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACqB,sBADD,EAEzBe,OAAO,CAAC+B,eAFiB,CAA3B;;AAIA,MAAI3B,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAACiE,2BAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM1E,GAAG,CAACW,OAAO,CAAC,iBAAD,CAAR,CAAT;AACA,UAAMX,GAAG,CAACS,qBAAqB,CAACkE,6BAAtB,EAAD,CAAT;AACD;AACF;;AAED,UAAU/C,kBAAV,QASE;AAAA,MAT2B;AAC3Bc,IAAAA;AAD2B,GAS3B;AACA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACsB,kBADD,EAEzBc,OAFyB,CAA3B;;AAIA,MAAII,QAAQ,CAACD,MAAT,KAAoB,GAApB,IAA2BC,QAAQ,CAACD,MAAT,KAAoB,GAAnD,EAAwD;AACtD,UAAM7C,GAAG,CAACS,qBAAqB,CAACmE,uBAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM5E,GAAG,CACPS,qBAAqB,CAACW,uBAAtB,CAA8CsB,OAAO,CAACmC,EAAR,CAAWC,QAAX,EAA9C,CADO,CAAT;AAGA,UAAM9E,GAAG,CAACS,qBAAqB,CAACsE,oBAAtB,CAA2C;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAA3C,CAAD,CAAT;AACD;AACF;;AAED,UAAUnD,iBAAV,QASE;AAAA,MAT0B;AAC1Ba,IAAAA;AAD0B,GAS1B;AACA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACuB,iBADD,EAEzBa,OAFyB,CAA3B;;AAIA,MAAII,QAAQ,CAACD,MAAT,KAAoB,GAApB,IAA2BC,QAAQ,CAACD,MAAT,KAAoB,GAAnD,EAAwD;AACtD,UAAM7C,GAAG,CAACS,qBAAqB,CAACwE,sBAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAMjF,GAAG,CAACS,qBAAqB,CAACyE,wBAAtB,CAA+CxC,OAAO,CAACyC,OAAvD,CAAD,CAAT;AACA,UAAMnF,GAAG,CAACS,qBAAqB,CAACsE,oBAAtB,CAA2C;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAA3C,CAAD,CAAT;AACD;AACF;;AAED,UAAUjD,iBAAV,SAQE;AAAA,MAR0B;AAC1BW,IAAAA;AAD0B,GAQ1B;AACA,QAAMI,QAAQ,GAAG,MAAM/C,IAAI,CACzBO,yBAAyB,CAACyB,iBADD,EAEzBW,OAAO,CAACmC,EAFiB,CAA3B;;AAIA,MAAI/B,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAAC2E,sBAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAMpF,GAAG,CACPS,qBAAqB,CAACW,uBAAtB,CAA8CsB,OAAO,CAACmC,EAAR,CAAWC,QAAX,EAA9C,CADO,CAAT;AAGD;AACF;;AAED,UAAU7C,qBAAV,GAKE;AACA,QAAMa,QAAQ,GAAG,MAAM/C,IAAI,CAACO,yBAAyB,CAAC2B,qBAA3B,CAA3B;;AACA,MAAIa,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAAC4E,0BAAtB,EAAD,CAAT;AACD,GAFD,MAEO;AACL,UAAM;AAAElC,MAAAA;AAAF,QAAaL,QAAQ,CAACG,IAA5B;AACA,UAAMjD,GAAG,CAACS,qBAAqB,CAAC6E,4BAAtB,CAAmDnC,MAAnD,CAAD,CAAT;AACD;AACF;;AAED,UAAUjB,YAAV,SAUE;AAAA,MAVqB;AACrBQ,IAAAA;AADqB,GAUrB;AACA,QAAM,CAACI,QAAD,IAAa,MAAM3C,GAAG,CAAC,CAC3BJ,IAAI,CAACO,yBAAyB,CAACiF,wBAA3B,EAAqD7C,OAArD,CADuB,EAE3BzC,KAAK,CAACI,oBAAD,CAFsB,CAAD,CAA5B;;AAKA,MAAIyC,QAAQ,CAACD,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,UAAM7C,GAAG,CAACS,qBAAqB,CAAC+E,iBAAtB,EAAD,CAAT;;AACA,QAAI1C,QAAQ,CAACG,IAAT,CAAcwC,UAAd,KAA6B,KAAjC,EAAwC;AACtC,YAAMxF,KAAK,CAAC,IAAD,CAAX;AACA,YAAMD,GAAG,CAACS,qBAAqB,CAACiF,qBAAtB,CAA4C,KAA5C,CAAD,CAAT;AACA,YAAM1F,GAAG,CACPQ,mBAAmB,CAAC0D,gBAApB,CAAqC;AACnCC,QAAAA,KAAK,EAAE,OAD4B;AAEnCC,QAAAA,KAAK,EAAE1D,OAAO,CAAC2D,CAAR,CAAU,8CAAV,CAF4B;AAGnCjC,QAAAA,IAAI,EAAE1B,OAAO,CAAC2D,CAAR,CAAU,6CAAV,CAH6B;AAInCsB,QAAAA,OAAO,EAAE,MAAMjD,OAAO,CAACkD,QAAR,CAAiBlD,OAAO,CAACmC,EAAzB;AAJoB,OAArC,CADO,CAAT;AAQD;AACF,GAdD,MAcO;AACL,UAAM7E,GAAG,CAACS,qBAAqB,CAACoF,mBAAtB,EAAD,CAAT;AACD;AACF","sourcesContent":["import { PayloadAction } from \"@reduxjs/toolkit\";\nimport { AxiosResponse } from \"axios\";\nimport moment from \"moment\";\nimport { ApiResponse } from \"middleware/api\";\nimport { detailPreliquidationDatePicker } from \"pages/preliquidation/DetailPreliquidation/invoice/types\";\n\nimport {\n  call,\n  CallEffect,\n  put,\n  delay,\n  PutEffect,\n  takeLatest,\n  all,\n  AllEffect,\n} from \"redux-saga/effects\";\nimport { DATE_FORMATS, FIRST_ANIMATION_TIME } from \"utils/constants\";\nimport * as preliquidationsMiddleware from \"../middleware/preliquidations\";\nimport { actions as notificationActions } from \"../reducers/notification\";\nimport { actions as preliquidationActions } from \"../reducers/preliquidation\";\nimport {\n  AdjustAmountMiddlewareType,\n  AdjustmenResponseType,\n  DetailPreliquidationBodyParamsType,\n  DetailPreliquidationsApiResponseType,\n  DetailPreliquidationsContentResponseType,\n  DetailPreliquidationsInvoiceApiResponseType,\n  DetailPreliquidationsInvoiceTypesApiResponseType,\n  DetatilPreliquidationsApiResponse,\n  PreliquidationCastParamsMiddlewareType,\n  PreliquidationParamsMiddlewareType,\n  PreliquidationsApiResponse,\n  RejectInvoiceMiddlewareType,\n  UploadInvoiceFileMiddlewareType,\n} from \"./types/preliquidation\";\nimport i18next from \"i18next\";\nimport { NotificationStateType } from \"reducers/types/notification\";\nimport { replace } from \"connected-react-router\";\n\nconst sagas = [\n  takeLatest(\n    preliquidationActions.getPreliquidationsRequest.type,\n    getPreliquidations\n  ),\n  takeLatest(\n    preliquidationActions.getDetailPreliquidationsRequest.type,\n    getDetailPreliquidations\n  ),\n  takeLatest(\n    preliquidationActions.getMorePreliquidationsRequest.type,\n    getMorePreliquidations\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailRequest.type,\n    getInvoiceDetail\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailSaveRequest.type,\n    putSaveDetailInvoice\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailApproveRequest.type,\n    patchApproveDetailInvoice\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailDeleteRequest.type,\n    putDeleteDetailInvoice\n  ),\n  takeLatest(preliquidationActions.replaceInvoiceFile.type, replaceInvoiceFile),\n  takeLatest(preliquidationActions.uploadInvoiceFile.type, uploadInvoiceFile),\n  takeLatest(\n    preliquidationActions.deleteInvoiceFileRequest.type,\n    deleteInvoiceFile\n  ),\n  takeLatest(\n    preliquidationActions.getInvoiceDetailTypesRequest.type,\n    getDetailInvoiceTypes\n  ),\n  takeLatest(preliquidationActions.adjustAmount.type, adjustAmount),\n];\n\nexport default sagas;\n\nconst process = (body: DetailPreliquidationBodyParamsType) => {\n  return {\n    ...body,\n    emisionDate: body?.emisionDate\n      ? moment(body?.emisionDate, DATE_FORMATS.shortDate).format(\n          DATE_FORMATS.shortISODate\n        )\n      : null,\n  };\n};\n\nconst processDatePicker = (\n  payload: PreliquidationParamsMiddlewareType\n): PreliquidationCastParamsMiddlewareType => {\n  let payloadCast: PreliquidationCastParamsMiddlewareType =\n    payload as PreliquidationCastParamsMiddlewareType;\n\n  const { generatedAt } = payload;\n  if (!generatedAt) delete payloadCast.generatedAt;\n  else {\n    payloadCast = {\n      ...payload,\n      generatedAt: moment(generatedAt, DATE_FORMATS.shortDate).format(\n        DATE_FORMATS.shortISODate\n      ),\n    };\n  }\n\n  return payloadCast;\n};\n\nfunction* getPreliquidations({\n  payload,\n}: PayloadAction<PreliquidationParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PreliquidationsApiResponse>>\n  | PutEffect<{ type: string }>,\n  void,\n  PreliquidationsApiResponse\n> {\n  if (payload?.status === \"\") {\n    delete payload[\"status\"];\n  }\n  let payloadCast: PreliquidationCastParamsMiddlewareType =\n    processDatePicker(payload);\n\n  const response = yield call(\n    preliquidationsMiddleware.getPreliquidations,\n    payloadCast\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getPreliquidationsError());\n  } else {\n    yield put(preliquidationActions.getPreliquidationsSuccess(response.data));\n  }\n}\n\nfunction* getDetailPreliquidations({\n  payload,\n}: PayloadAction<number>): Generator<\n  | CallEffect<AxiosResponse<DetatilPreliquidationsApiResponse>>\n  | PutEffect<{ type: string }>,\n  void,\n  DetatilPreliquidationsApiResponse\n> {\n  const response = yield call(\n    preliquidationsMiddleware.getDetailPreliquidations,\n    payload\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getDetailPreliquidationsError());\n  } else {\n    const { result } = response.data;\n    yield put(preliquidationActions.getDetailPreliquidationsSuccess(result));\n  }\n}\n\nfunction* getMorePreliquidations({\n  payload,\n}: PayloadAction<PreliquidationParamsMiddlewareType>): Generator<\n  | CallEffect<AxiosResponse<PreliquidationsApiResponse>>\n  | PutEffect<{ type: string }>,\n  void,\n  PreliquidationsApiResponse\n> {\n  let payloadCast: PreliquidationCastParamsMiddlewareType =\n    processDatePicker(payload);\n  const response = yield call(\n    preliquidationsMiddleware.getPreliquidations,\n    payloadCast\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getMorePreliquidationsError());\n  } else {\n    const {\n      result: { items },\n      ...rest\n    } = response.data;\n    yield put(\n      preliquidationActions.getMorePreliquidationsSuccess({ items, ...rest })\n    );\n  }\n}\n\nfunction* getInvoiceDetail({\n  payload,\n}: PayloadAction<string | undefined>): Generator<\n  | PutEffect<{\n      payload: DetailPreliquidationsContentResponseType;\n      type: string;\n    }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsContentResponseType>>,\n  void,\n  DetailPreliquidationsApiResponseType\n> {\n  const response = yield call(\n    preliquidationsMiddleware.getDetailInvoice,\n    payload\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailError());\n  } else {\n    const { result } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailSuccess(result));\n  }\n}\n\nfunction* putSaveDetailInvoice({\n  payload,\n}: PayloadAction<detailPreliquidationDatePicker>): Generator<\n  | PutEffect<{ payload: detailPreliquidationDatePicker; type: string }>\n  | PutEffect<{ type: string }>\n  | PutEffect<{ type: string; content: NotificationStateType }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceApiResponseType\n> {\n  let result: DetailPreliquidationBodyParamsType = {\n    emisionDate: payload.emisionDate || null,\n    invoiceType: payload.invoiceType?.tag ? payload.invoiceType : null,\n    invoiceNumber: payload.invoiceNumber || null,\n    salePoint: payload.salePoint || null,\n    caeNumber: payload.caeNumber || null,\n  };\n  result = process(result);\n\n  const response = yield call(\n    preliquidationsMiddleware.putSaveDetailInvoice,\n    payload.presettementId,\n    result\n  );\n  if (response.status !== 200) {\n    yield put(\n      notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"global:title.modal.connectionError\"),\n        body: i18next.t(\"global:label.modal.connectionError\"),\n      })\n    );\n    yield put(preliquidationActions.getInvoiceDetailSaveError());\n  } else {\n    yield put(replace(\"/presettlements\"));\n    yield put(preliquidationActions.getInvoiceDetailSaveSuccess());\n  }\n}\n\nfunction* patchApproveDetailInvoice({\n  payload,\n}: PayloadAction<detailPreliquidationDatePicker>): Generator<\n  | PutEffect<{ payload: detailPreliquidationDatePicker; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceApiResponseType\n> {\n  let result: DetailPreliquidationBodyParamsType = {\n    emisionDate: payload.emisionDate || \"\",\n    invoiceType: payload.invoiceType,\n    invoiceNumber: payload.invoiceNumber,\n    salePoint: payload.salePoint,\n    caeNumber: payload.caeNumber,\n  };\n  result = process(result);\n\n  const response = yield call(\n    preliquidationsMiddleware.patchApproveDetailInvoice,\n    payload.presettementId,\n    result\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailApproveError());\n    yield put(\n      notificationActions.showNotification({\n        level: \"error\",\n        title: i18next.t(\"global:title.modal.connectionError\"),\n        body: i18next.t(\"global:label.modal.connectionError\"),\n      })\n    );\n  } else {\n    yield put(replace(\"/presettlements\"));\n  }\n}\n\nfunction* putDeleteDetailInvoice({\n  payload,\n}: PayloadAction<RejectInvoiceMiddlewareType>): Generator<\n  | PutEffect<{ payload: detailPreliquidationDatePicker; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceApiResponseType\n> {\n  const response = yield call(\n    preliquidationsMiddleware.putDeleteDetailInvoice,\n    payload.presettlementId\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailDeleteError());\n  } else {\n    yield put(replace(\"/presettlements\"));\n    yield put(preliquidationActions.getInvoiceDetailDeleteSuccess());\n  }\n}\n\nfunction* replaceInvoiceFile({\n  payload,\n}: PayloadAction<UploadInvoiceFileMiddlewareType>): Generator<\n  | PutEffect<{ payload: string; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<ApiResponse<void>>>,\n  void,\n  ApiResponse<void>\n> {\n  const response = yield call(\n    preliquidationsMiddleware.replaceInvoiceFile,\n    payload\n  );\n  if (response.status !== 200 && response.status !== 201) {\n    yield put(preliquidationActions.replaceInvoiceFileError());\n  } else {\n    yield put(\n      preliquidationActions.getInvoiceDetailRequest(payload.id.toString())\n    );\n    yield put(preliquidationActions.setInvoiceFileStatus({ loading: false }));\n  }\n}\n\nfunction* uploadInvoiceFile({\n  payload,\n}: PayloadAction<UploadInvoiceFileMiddlewareType>): Generator<\n  | PutEffect<{ payload: string; type: string }>\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<ApiResponse<void>>>,\n  void,\n  ApiResponse<void>\n> {\n  const response = yield call(\n    preliquidationsMiddleware.uploadInvoiceFile,\n    payload\n  );\n  if (response.status !== 200 && response.status !== 201) {\n    yield put(preliquidationActions.uploadInvoiceFileError());\n  } else {\n    yield put(preliquidationActions.uploadInvoiceFileSuccess(payload.content));\n    yield put(preliquidationActions.setInvoiceFileStatus({ loading: false }));\n  }\n}\n\nfunction* deleteInvoiceFile({\n  payload,\n}: PayloadAction<{ id: number }>): Generator<\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ payload: string | undefined; type: string }>\n  | CallEffect<AxiosResponse<ApiResponse<void>>>,\n  void,\n  ApiResponse<void>\n> {\n  const response = yield call(\n    preliquidationsMiddleware.deleteInvoiceFile,\n    payload.id\n  );\n  if (response.status !== 200) {\n    yield put(preliquidationActions.deleteInvoiceFileError());\n  } else {\n    yield put(\n      preliquidationActions.getInvoiceDetailRequest(payload.id.toString())\n    );\n  }\n}\n\nfunction* getDetailInvoiceTypes(): Generator<\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<DetailPreliquidationsInvoiceTypesApiResponseType>>,\n  void,\n  DetailPreliquidationsInvoiceTypesApiResponseType\n> {\n  const response = yield call(preliquidationsMiddleware.getDetailInvoiceTypes);\n  if (response.status !== 200) {\n    yield put(preliquidationActions.getInvoiceDetailTypesError());\n  } else {\n    const { result } = response.data;\n    yield put(preliquidationActions.getInvoiceDetailTypesSuccess(result));\n  }\n}\n\nfunction* adjustAmount({\n  payload,\n}: PayloadAction<AdjustAmountMiddlewareType>): Generator<\n  | PutEffect<{ payload: undefined; type: string }>\n  | PutEffect<{ type: string; content: NotificationStateType }>\n  | PutEffect<{ type: string }>\n  | CallEffect<AxiosResponse<ApiResponse<void>>>\n  | AllEffect<CallEffect<any> | CallEffect<true>>,\n  void,\n  [ApiResponse<AdjustmenResponseType>]\n> {\n  const [response] = yield all([\n    call(preliquidationsMiddleware.preliquidationAdjustment, payload),\n    delay(FIRST_ANIMATION_TIME),\n  ]);\n\n  if (response.status !== 200) {\n    yield put(preliquidationActions.adjustAmountError());\n    if (response.data.statusCode === 30020) {\n      yield delay(2500);\n      yield put(preliquidationActions.toggleModalVisibility(false));\n      yield put(\n        notificationActions.showNotification({\n          level: \"error\",\n          title: i18next.t(\"detailPreliquidation:title.modal.concurrency\"),\n          body: i18next.t(\"detailPreliquidation:body.modal.concurrency\"),\n          onClick: () => payload.callback(payload.id)\n        })\n      );\n    }\n  } else {\n    yield put(preliquidationActions.adjustAmountSuccess());\n  }\n}\n"]},"metadata":{},"sourceType":"module"}