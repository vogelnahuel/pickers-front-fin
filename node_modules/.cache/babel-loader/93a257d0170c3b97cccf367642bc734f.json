{"ast":null,"code":"var _jsxFileName = \"/home/nahuel/pickers-admin-front/src/pages/preliquidation/DetailPreliquidation/invoice/InvoiceContainer.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport Invoice from \"./Invoice\";\nimport { actions as preliActions, preliquidationSelector } from \"reducers/preliquidation\";\nimport { actions as notificationActions } from \"reducers/notification\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport * as yup from \"yup\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { DATE_FORMATS, MAX_FILE_SIZE, VALIDATION_REGEX } from \"utils/constants\";\nimport { getBase64FromUrl, isBase64, toBase64 } from \"utils/toBase64\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst InvoiceContainer = props => {\n  _s();\n\n  const params = useParams();\n  useEffect(() => {\n    props.setInvoiceFileStatus({\n      loading: false,\n      error: false\n    });\n    props.setActualPage(\"INVOICE\");\n    props.getInvoiceDetailTypes();\n    props.getInvoiceDetail(params.id); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fileHandler = async file => {\n    props.setInvoiceFileStatus({\n      loading: true\n    });\n\n    if (file.size > MAX_FILE_SIZE || file.type !== \"application/pdf\") {\n      props.setInvoiceFileStatus({\n        error: true,\n        loading: false,\n        message: 'component:label.pdfController.invalidFile'\n      });\n      return;\n    } else {\n      try {\n        const base64 = await toBase64(file);\n        props.uploadInvoiceFile({\n          id: parseInt(params.id || '0'),\n          content: base64\n        });\n      } catch (err) {\n        console.log(\"Base64 error: \", err);\n      }\n    }\n  };\n\n  const history = useHistory();\n\n  const handleClickBack = dirty => {\n    const onClose = () => history.goBack();\n\n    if (!dirty) {\n      onClose();\n    } else {\n      showDirtyNotification(onClose);\n    }\n  };\n\n  const showDirtyNotification = onClose => {\n    const html = document.documentElement;\n    const height = Math.max(html.clientHeight, html.scrollHeight);\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"pickers:title.modal.saveChanges\"),\n      body: i18next.t(\"pickers:label.modal.saveChanges\"),\n      onClickLabel: \"pickers:button.modal.goToSave\",\n      onCloseLabel: \"pickers:button.modal.notSave\",\n      onClose: onClose,\n      onClick: () => window.scroll({\n        top: height,\n        left: 0,\n        behavior: \"smooth\"\n      })\n    });\n  };\n\n  const showWrongFilesNotification = onClose => props.showNotification({\n    level: \"warning\",\n    title: i18next.t(\"global:title.modal.withoutSaving\"),\n    body: i18next.t(\"global:label.modal.withoutSaving\"),\n    onClickLabel: i18next.t(\"global:label.button.checkErrors\"),\n    onCloseLabel: i18next.t(\"global:label.button.continue\"),\n    onClose: onClose,\n    onClick: undefined\n  });\n\n  const changePage = (page, isDirty) => {\n    const onClose = () => {\n      props.setActualPage(page);\n      history.replace(\"/preliquidation\");\n    };\n\n    if (isDirty) showDirtyNotification(onClose);else if (props.invoiceFileStatus.error) {\n      showWrongFilesNotification(onClose);\n    } else onClose();\n  };\n\n  const deleteFile = () => {\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"invoice:title.modal.deleteInvoice\"),\n      body: i18next.t(\"invoice:label.modal.deleteInvoice\"),\n      onClickLabel: \"invoice:button.modal.delete\",\n      onCloseLabel: \"invoice:button.modal.cancel\",\n      onClose: undefined,\n      onClick: () => props.deleteInvoiceFile(parseInt(params.id || '0'))\n    });\n  };\n\n  const goToPreviousFile = () => {\n    props.setInvoiceFileStatus({\n      error: false,\n      loading: false\n    });\n  };\n\n  const downloadFile = async () => {\n    var _props$invoiceDetail, _props$invoiceDetail$;\n\n    const url = (_props$invoiceDetail = props.invoiceDetail) === null || _props$invoiceDetail === void 0 ? void 0 : (_props$invoiceDetail$ = _props$invoiceDetail.invoiceFile) === null || _props$invoiceDetail$ === void 0 ? void 0 : _props$invoiceDetail$.url;\n    if (!url) return;\n    const now = new Date();\n    const date = `${now.getDate()}_${now.getMonth() + 1}_${now.getFullYear()}`;\n    const time = `${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`;\n    const downloadLink = document.createElement(\"a\");\n    const fileName = `preli-${params.id || \"\"}-${date}_${time}.pdf`;\n\n    if (isBase64(url)) {\n      downloadLink.href = url;\n    } else {\n      const base64 = await getBase64FromUrl(url);\n      downloadLink.href = base64;\n    }\n\n    downloadLink.download = fileName;\n    downloadLink.click();\n  };\n\n  const validarFechas = value => {\n    var _props$detailPreliqui;\n\n    if (!value) return true;\n    const valueProps = moment(value.from, \"DD/MM/YYYY\");\n    const today = moment();\n    const startDate = moment((_props$detailPreliqui = props.detailPreliquidations) === null || _props$detailPreliqui === void 0 ? void 0 : _props$detailPreliqui.generatedAt);\n    const range = valueProps.isBetween(startDate, today);\n    return range;\n  };\n\n  const castDatePicker = detailPreliquidations => {\n    let castear = detailPreliquidations;\n    castear = { ...castear,\n      emisionDate: {\n        from: detailPreliquidations.emisionDate ? moment(detailPreliquidations.emisionDate).format(DATE_FORMATS.shortDate) : \"\"\n      }\n    };\n    return castear;\n  };\n\n  const validationSchema = yup.object({\n    emisionDate: yup.object().required(\"\").test(\"errorDatePicker\", i18next.t(\"global:error.input.emisionDate\"), value => validarFechas(value)),\n    invoiceType: yup.object({\n      name: yup.string().required(\"global:error.input.required\")\n    }),\n    salePoint: yup.string().min(4, i18next.t(\"global:error.input.salePoint\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.salePoint\")),\n    invoiceNumber: yup.string().min(8, i18next.t(\"global:error.input.invoiceNumber\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.invoiceNumber\")),\n    caeNumber: yup.string().min(14, i18next.t(\"global:error.input.caeNumber\")).required(\"\").matches(VALIDATION_REGEX.regNumber, i18next.t(\"global:error.input.caeNumber\"))\n  });\n  return /*#__PURE__*/_jsxDEV(Invoice, { ...props,\n    fileHandler: fileHandler,\n    deleteFile: deleteFile,\n    downloadFile: downloadFile,\n    validationSchema: validationSchema,\n    castDatePicker: castDatePicker,\n    presettementId: params.id,\n    handleClickBack: handleClickBack,\n    changePage: changePage,\n    goToPreviousFile: goToPreviousFile\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 222,\n    columnNumber: 5\n  }, this);\n};\n\n_s(InvoiceContainer, \"cFUx5pkkxnCxiZjbc8lzHxGIgt4=\", false, function () {\n  return [useParams, useHistory];\n});\n\n_c = InvoiceContainer;\n\nconst mapStateToProps = state => ({\n  isFetching: preliquidationSelector(state).fetching,\n  invoiceDetail: preliquidationSelector(state).invoiceDetail,\n  detailPreliquidations: preliquidationSelector(state).detailPreliquidations,\n  invoiceFileStatus: preliquidationSelector(state).invoiceFileStatus,\n  invoiceTypes: preliquidationSelector(state).invoiceTypes\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setActualPage: page => {\n    dispatch(preliActions.setActualPage(page));\n  },\n  getInvoiceDetail: params => {\n    dispatch(preliActions.getInvoiceDetailRequest(params));\n  },\n  getInvoiceDetailSave: params => {\n    dispatch(preliActions.getInvoiceDetailSaveRequest(params));\n  },\n  getInvoiceDetailApprove: params => {\n    dispatch(preliActions.getInvoiceDetailApproveRequest(params));\n  },\n  getInvoiceDetailDelete: params => {\n    dispatch(preliActions.getInvoiceDetailDeleteRequest(params));\n  },\n  uploadInvoiceFile: params => {\n    dispatch(preliActions.uploadInvoiceFile(params));\n  },\n  deleteInvoiceFile: id => {\n    dispatch(preliActions.deleteInvoiceFileRequest({\n      id\n    }));\n  },\n  getInvoiceDetailTypes: () => {\n    dispatch(preliActions.getInvoiceDetailTypesRequest());\n  },\n  setDirty: dirty => {\n    dispatch(preliActions.setDirty(dirty));\n  },\n  showNotification: content => {\n    dispatch(notificationActions.showNotification(content));\n  },\n  setInvoiceFileStatus: params => {\n    dispatch(preliActions.setInvoiceFileStatus(params));\n  }\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InvoiceContainer);\n\nvar _c;\n\n$RefreshReg$(_c, \"InvoiceContainer\");","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/pages/preliquidation/DetailPreliquidation/invoice/InvoiceContainer.tsx"],"names":["useEffect","connect","Invoice","actions","preliActions","preliquidationSelector","notificationActions","useHistory","useParams","yup","i18next","moment","DATE_FORMATS","MAX_FILE_SIZE","VALIDATION_REGEX","getBase64FromUrl","isBase64","toBase64","InvoiceContainer","props","params","setInvoiceFileStatus","loading","error","setActualPage","getInvoiceDetailTypes","getInvoiceDetail","id","fileHandler","file","size","type","message","base64","uploadInvoiceFile","parseInt","content","err","console","log","history","handleClickBack","dirty","onClose","goBack","showDirtyNotification","html","document","documentElement","height","Math","max","clientHeight","scrollHeight","showNotification","level","title","t","body","onClickLabel","onCloseLabel","onClick","window","scroll","top","left","behavior","showWrongFilesNotification","undefined","changePage","page","isDirty","replace","invoiceFileStatus","deleteFile","deleteInvoiceFile","goToPreviousFile","downloadFile","url","invoiceDetail","invoiceFile","now","Date","date","getDate","getMonth","getFullYear","time","getHours","getMinutes","getSeconds","downloadLink","createElement","fileName","href","download","click","validarFechas","value","valueProps","from","today","startDate","detailPreliquidations","generatedAt","range","isBetween","castDatePicker","castear","emisionDate","format","shortDate","validationSchema","object","required","test","invoiceType","name","string","salePoint","min","matches","regNumber","invoiceNumber","caeNumber","mapStateToProps","state","isFetching","fetching","invoiceTypes","mapDispatchToProps","dispatch","getInvoiceDetailRequest","getInvoiceDetailSave","getInvoiceDetailSaveRequest","getInvoiceDetailApprove","getInvoiceDetailApproveRequest","getInvoiceDetailDelete","getInvoiceDetailDeleteRequest","deleteInvoiceFileRequest","getInvoiceDetailTypesRequest","setDirty"],"mappings":"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","sourcesContent":["import { useEffect } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { AppDispatch, RootState } from \"store\";\nimport Invoice from \"./Invoice\";\nimport {\n  actions as preliActions,\n  preliquidationSelector,\n} from \"reducers/preliquidation\";\nimport { actions as notificationActions } from \"reducers/notification\";\nimport {\n  detailPreliquidationDatePicker,\n  detailPreliquidationInvoiceContainerPropsType,\n  invoiceValidationSchema,\n} from \"./types\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport { UploadInvoiceFileMiddlewareType } from \"sagas/types/preliquidation\";\nimport * as yup from \"yup\";\nimport i18next from \"i18next\";\nimport moment from \"moment\";\nimport { DATE_FORMATS, MAX_FILE_SIZE, VALIDATION_REGEX } from \"utils/constants\";\nimport { ObjectShape, TypeOfShape } from \"yup/lib/object\";\nimport { getBase64FromUrl, isBase64, toBase64 } from \"utils/toBase64\";\nimport { InvoiceFileStatus, DetailInvoiceType } from \"reducers/types/preliquidation\";\nimport { NotificationStateType } from \"reducers/types/notification\";\n\n\nconst InvoiceContainer = (\n  props: detailPreliquidationInvoiceContainerPropsType\n): JSX.Element => {\n  const params: { id?: string } = useParams();\n \n\n  useEffect(() => {\n    props.setInvoiceFileStatus({ loading: false, error: false });\n    props.setActualPage(\"INVOICE\");\n    props.getInvoiceDetailTypes();\n    props.getInvoiceDetail(params.id);\n    \n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fileHandler = async (file: File) => {\n    props.setInvoiceFileStatus({ loading: true });\n    \n    if (file.size > MAX_FILE_SIZE || file.type !== \"application/pdf\") {\n      props.setInvoiceFileStatus({\n        error: true,\n        loading: false,\n        message: 'component:label.pdfController.invalidFile'\n      });\n      return;\n    } else {\n      try {\n        const base64 = await toBase64(file) as string;\n        props.uploadInvoiceFile({ id: parseInt(params.id || '0'), content: base64 });\n      } catch (err) {\n        console.log(\"Base64 error: \", err);\n      }\n    }\n  };\n  const history = useHistory();\n  const handleClickBack = (dirty: boolean) => {\n    const onClose = () => history.goBack()\n    if (!dirty) { onClose() }\n    else { showDirtyNotification(onClose) }\n  };\n\n  const showDirtyNotification = (onClose: Function) => {\n    const html = document.documentElement;\n    const height = Math.max(html.clientHeight, html.scrollHeight);\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"pickers:title.modal.saveChanges\"),\n      body: i18next.t(\"pickers:label.modal.saveChanges\"),\n      onClickLabel: \"pickers:button.modal.goToSave\",\n      onCloseLabel: \"pickers:button.modal.notSave\",\n      onClose: onClose,\n      onClick: () =>\n        window.scroll({\n          top: height,\n          left: 0,\n          behavior: \"smooth\",\n        }),\n    });\n  }\n\n\n  const showWrongFilesNotification = (onClose: Function) =>\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"global:title.modal.withoutSaving\"),\n      body: i18next.t(\"global:label.modal.withoutSaving\"),\n      onClickLabel: i18next.t(\"global:label.button.checkErrors\"),\n      onCloseLabel: i18next.t(\"global:label.button.continue\"),\n      onClose: onClose,\n      onClick: undefined,\n    });\n\n  const changePage = (page: string, isDirty: boolean) => {\n    const onClose = () => {\n      props.setActualPage(page);\n\n      history.replace(\"/preliquidation\");\n\n    }\n    if (isDirty) showDirtyNotification(onClose);\n    else if (props.invoiceFileStatus.error) { showWrongFilesNotification(onClose) }\n    else onClose();\n  };\n\n  const deleteFile = () => {\n    props.showNotification({\n      level: \"warning\",\n      title: i18next.t(\"invoice:title.modal.deleteInvoice\"),\n      body: i18next.t(\"invoice:label.modal.deleteInvoice\"),\n      onClickLabel: \"invoice:button.modal.delete\",\n      onCloseLabel: \"invoice:button.modal.cancel\",\n      onClose: undefined,\n      onClick: () => props.deleteInvoiceFile(parseInt(params.id||'0'))\n    });\n  }\n\n  const goToPreviousFile = () => {\n    props.setInvoiceFileStatus({\n      error: false,\n      loading: false,\n    });\n  }\n\n  const downloadFile = async () => {\n\n    const url = props.invoiceDetail?.invoiceFile?.url;\n    if (!url) return;\n\n    const now = new Date();\n    const date = `${now.getDate()}_${now.getMonth() + 1}_${now.getFullYear()}`;\n    const time = `${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`\n    const downloadLink = document.createElement(\"a\");\n    const fileName = `preli-${params.id || \"\"}-${date}_${time}.pdf`;\n    \n    if(isBase64(url)){\n      downloadLink.href = url;\n    }\n    else{\n      const base64 = await getBase64FromUrl(url) as string;\n      downloadLink.href = base64;\n    }\n    downloadLink.download = fileName;\n    downloadLink.click();\n  }\n\n\n  const validarFechas = (value: TypeOfShape<ObjectShape>) => {\n  \n    if (!value ) return true;\n\n    const valueProps = moment(value.from, \"DD/MM/YYYY\");\n    const today = moment();\n    const startDate = moment(props.detailPreliquidations?.generatedAt);\n\n    const range = valueProps.isBetween(startDate, today);\n\n    return range;\n  };\n\n  const castDatePicker = (\n    detailPreliquidations: DetailInvoiceType\n  ) => {\n    let castear:\n      | detailPreliquidationDatePicker\n      | DetailInvoiceType = detailPreliquidations;\n      \n    castear = {\n      ...castear,\n      emisionDate: { from: detailPreliquidations.emisionDate  ? moment(detailPreliquidations.emisionDate).format(DATE_FORMATS.shortDate) : \"\"},\n    };\n    return castear;\n  };\n\n  const validationSchema: yup.SchemaOf<invoiceValidationSchema> = yup.object({\n    emisionDate: yup\n      .object()\n      .required(\"\")\n      .test(\n        \"errorDatePicker\",\n        i18next.t(\"global:error.input.emisionDate\"),\n        (value) => validarFechas(value)\n      ),\n    invoiceType: yup.object({\n      name: yup.string().required(\"global:error.input.required\"),\n    }),\n    salePoint: yup\n      .string()\n      .min(4, i18next.t(\"global:error.input.salePoint\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.salePoint\")\n      ),\n\n    invoiceNumber: yup\n      .string()\n      .min(8, i18next.t(\"global:error.input.invoiceNumber\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.invoiceNumber\")\n      ),\n\n    caeNumber: yup\n      .string()\n      .min(14, i18next.t(\"global:error.input.caeNumber\"))\n      .required(\"\")\n      .matches(\n        VALIDATION_REGEX.regNumber,\n        i18next.t(\"global:error.input.caeNumber\")\n      ),\n  });\n\n  return (\n    <Invoice\n      {...props}\n      fileHandler={fileHandler}\n      deleteFile={deleteFile}\n      downloadFile={downloadFile}\n      validationSchema={validationSchema}\n      castDatePicker={castDatePicker}\n      presettementId={params.id}\n      handleClickBack={handleClickBack}\n      changePage={changePage}\n      goToPreviousFile={goToPreviousFile}\n    />\n  );\n};\n\nconst mapStateToProps = (state: RootState) => ({\n  isFetching: preliquidationSelector(state).fetching,\n  invoiceDetail: preliquidationSelector(state).invoiceDetail,\n  detailPreliquidations: preliquidationSelector(state).detailPreliquidations,\n  invoiceFileStatus: preliquidationSelector(state).invoiceFileStatus,\n  invoiceTypes: preliquidationSelector(state).invoiceTypes,\n});\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => ({\n  setActualPage: (page: string) => {\n    dispatch(preliActions.setActualPage(page));\n  },\n  getInvoiceDetail: (params: string | undefined) => {\n    dispatch(preliActions.getInvoiceDetailRequest(params));\n  },\n  getInvoiceDetailSave: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailSaveRequest(params));\n  },\n  getInvoiceDetailApprove: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailApproveRequest(params));\n  },\n  getInvoiceDetailDelete: (params: detailPreliquidationDatePicker) => {\n    dispatch(preliActions.getInvoiceDetailDeleteRequest(params));\n  },\n  uploadInvoiceFile: (params: UploadInvoiceFileMiddlewareType) => {\n    dispatch(preliActions.uploadInvoiceFile(params));\n  },\n  deleteInvoiceFile: (id: number) => {\n    dispatch(preliActions.deleteInvoiceFileRequest({ id }));\n  },\n  getInvoiceDetailTypes: () => {\n    dispatch(preliActions.getInvoiceDetailTypesRequest());\n  },\n  setDirty: (dirty: boolean) => {\n    dispatch(preliActions.setDirty(dirty));\n  },\n  showNotification: (content: NotificationStateType) => {\n    dispatch(notificationActions.showNotification(content));\n  },\n  setInvoiceFileStatus: (params: InvoiceFileStatus) => {\n    dispatch(preliActions.setInvoiceFileStatus(params));\n  }\n});\nexport default connect(mapStateToProps, mapDispatchToProps)(InvoiceContainer);\n"]},"metadata":{},"sourceType":"module"}