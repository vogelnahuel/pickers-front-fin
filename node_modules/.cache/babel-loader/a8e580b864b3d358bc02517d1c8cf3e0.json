{"ast":null,"code":"import { createSlice, createSelector } from \"@reduxjs/toolkit\";\nimport { LoadingButtonState } from \"component/loadingButton/types\";\nimport { endsWithAny } from \"utils/endsWithAny\";\nexport const initialState = {\n  fetching: false,\n  invoiceFileStatus: {\n    error: false,\n    loading: false,\n    message: \"\"\n  },\n  adjustingAmount: LoadingButtonState.Idle,\n  approvingInvoice: LoadingButtonState.Idle,\n  showEditPreliquidationModal: false,\n  preliquidations: [],\n  dirty: false,\n  preliquidationsSelected: [],\n  filters: {},\n  filtersExtra: {\n    limit: 3,\n    offset: 0\n  },\n  seeMore: true,\n  filtersExtraSeeMore: {\n    limit: 15,\n    offset: 0\n  },\n  invoiceTypes: [],\n  detailPreliquidations: {\n    id: 0,\n    status: {\n      id: 0,\n      description: \"\",\n      tag: \"\"\n    },\n    generatedAt: \"\",\n    fiscalNumber: \"\",\n    companyName: \"\",\n    sapCode: \"\",\n    total: 0.0,\n    manualCorrection: {\n      maxAllowedPlus: 0.0,\n      maxAllowedSubtract: 0.0\n    },\n    histories: [],\n    transactions: {\n      quantity: 0,\n      items: []\n    }\n  },\n  invoiceDetail: {\n    id: 0,\n    emisionDate: \"\",\n    invoiceNumber: \"\",\n    salePoint: \"\",\n    invoiceType: {\n      name: \"\",\n      tag: \"\"\n    },\n    caeNumber: \"\",\n    fiscalData: {\n      fiscalNumber: \"\",\n      companyName: \"\",\n      taxPayerType: \"\",\n      total: 0\n    },\n    invoiceFile: {\n      upload: false,\n      url: null\n    },\n    presettementId: undefined\n  },\n  actualPage: \"preliquidation\"\n};\nconst SLICE_NAME = \"preliquidation\";\n\nconst isRequestAction = action => {\n  const {\n    type\n  } = action;\n  return type.startsWith(SLICE_NAME) && type.endsWith(\"Request\");\n};\n\nconst isResponseAction = action => {\n  const {\n    type\n  } = action;\n  return type.startsWith(SLICE_NAME) && endsWithAny(type, [\"Error\", \"Success\"]);\n};\n\nexport const preliquidationSlice = createSlice({\n  name: SLICE_NAME,\n  initialState,\n  reducers: {\n    reset: state => {\n      state = { ...initialState\n      };\n    },\n    getPreliquidationsRequest: (state, action) => {},\n    getMorePreliquidationsRequest: (state, action) => {},\n    getPreliquidationsSuccess: (state, action) => {\n      const {\n        payload\n      } = action;\n      state.preliquidations = payload.result.items;\n      state.seeMore = payload.hasMore;\n      state.filtersExtraSeeMore.offset = payload.offset + payload.limit;\n    },\n    getMorePreliquidationsSuccess: (state, action) => {\n      const {\n        payload\n      } = action;\n      state.preliquidations = [...state.preliquidations, ...payload.items];\n      state.seeMore = payload.hasMore;\n      state.filtersExtraSeeMore.offset = payload.offset + payload.limit;\n    },\n    getPreliquidationsError: () => {},\n    getMorePreliquidationsError: () => {},\n    setPreliquidationFilters: (state, action) => {\n      state.filters = action.payload;\n    },\n    setPreliquidationExtraFilters: (state, action) => {\n      state.filtersExtra = { ...state.filtersExtra,\n        ...action.payload\n      };\n    },\n    getInvoiceDetailRequest: (state, action) => {},\n    getInvoiceDetailError: () => {},\n    getInvoiceDetailSuccess: (state, action) => {\n      const {\n        payload\n      } = action;\n      const {\n        presettlement,\n        ...invoice\n      } = payload;\n      state.invoiceDetail = invoice;\n      state.detailPreliquidations = { ...state.detailPreliquidations,\n        ...presettlement\n      };\n    },\n    getInvoiceDetailSaveRequest: (state, action) => {},\n    getInvoiceDetailSaveError: () => {},\n    getInvoiceDetailSaveSuccess: () => {},\n    getInvoiceDetailApproveFetch: (state, action) => {\n      state.approvingInvoice = LoadingButtonState.Loading;\n    },\n    getInvoiceDetailApproveError: state => {\n      state.approvingInvoice = LoadingButtonState.Error;\n    },\n    getInvoiceDetailApproveSuccess: state => {\n      state.approvingInvoice = LoadingButtonState.Success;\n    },\n    getInvoiceDetailDeleteRequest: (state, action) => {},\n    getInvoiceDetailDeleteError: () => {},\n    getInvoiceDetailDeleteSuccess: () => {},\n    replaceInvoiceFile: (state, action) => {},\n    replaceInvoiceFileError: state => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: true,\n        message: \"component:label.pdfController.serverError\"\n      };\n    },\n    uploadInvoiceFile: (state, action) => {},\n    uploadInvoiceFileError: state => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: true,\n        message: \"component:label.pdfController.serverError\"\n      };\n    },\n    uploadInvoiceFileSuccess: (state, action) => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: false,\n        message: \"\"\n      };\n      state.invoiceDetail.invoiceFile = {\n        upload: true,\n        url: action.payload\n      };\n    },\n    deleteInvoiceFileRequest: (state, action) => {},\n    deleteInvoiceFileError: state => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: true,\n        message: \"component:label.pdfController.serverError\"\n      };\n    },\n    deleteInvoiceFileSuccess: state => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: false,\n        message: \"\"\n      };\n      state.invoiceDetail.invoiceFile = {\n        upload: false,\n        url: null\n      };\n    },\n    sendAccountingRequest: (state, action) => {},\n    sendAccountingError: () => {},\n    sendAccountingSuccess: state => {\n      state.preliquidationsSelected = [];\n      state.filters = initialState.filters;\n      state.filtersExtra = initialState.filtersExtra;\n      state.filtersExtraSeeMore = initialState.filtersExtraSeeMore;\n    },\n    toggleModalVisibility: (state, action) => {\n      state.showEditPreliquidationModal = action.payload;\n    },\n    getInvoiceDetailTypesRequest: () => {},\n    getInvoiceDetailTypesError: () => {},\n    getInvoiceDetailTypesSuccess: (state, action) => {\n      const {\n        payload\n      } = action;\n      state.invoiceTypes = payload;\n    },\n    adjustAmount: (state, action) => {\n      state.adjustingAmount = LoadingButtonState.Loading;\n    },\n    adjustAmountError: state => {\n      state.adjustingAmount = LoadingButtonState.Error;\n    },\n    adjustAmountSuccess: state => {\n      state.adjustingAmount = LoadingButtonState.Success;\n    },\n    getDetailPreliquidationsRequest: (state, action) => {\n      state.adjustingAmount = LoadingButtonState.Idle;\n    },\n    getDetailPreliquidationsError: () => {},\n    getDetailPreliquidationsSuccess: (state, action) => {\n      state.detailPreliquidations = action.payload;\n    },\n    setDirty: (state, action) => {\n      state.dirty = action.payload;\n    },\n    setInvoiceFileStatus: (state, action) => {\n      state.invoiceFileStatus = { ...state.invoiceFileStatus,\n        ...action.payload\n      };\n    },\n    setActualPage: (state, action) => {\n      state.actualPage = action.payload;\n    },\n    resetAllSelected: (state, action) => {\n      state.preliquidationsSelected = [];\n    },\n    resetInvoiceDetail: state => {\n      state.invoiceDetail = initialState.invoiceDetail;\n    },\n    toggleItem: (state, action) => {\n      const item = action.payload;\n      const idx = state.preliquidationsSelected.findIndex(p => p.id === item.id);\n      if (idx >= 0) state.preliquidationsSelected.splice(idx, 1);else state.preliquidationsSelected.push(item);\n    },\n    toggleAll: state => {\n      const approvedItems = state.preliquidations.filter(p => {\n        var _p$status, _p$status2;\n\n        return ((_p$status = p.status) === null || _p$status === void 0 ? void 0 : _p$status.tag) === \"approved\" || ((_p$status2 = p.status) === null || _p$status2 === void 0 ? void 0 : _p$status2.tag) === \"pending_accounting\";\n      }); // Estan todas las preli seleccionadas\n\n      if (approvedItems.length === state.preliquidationsSelected.length) state.preliquidationsSelected = [];else state.preliquidationsSelected = approvedItems;\n    }\n  },\n  extraReducers: builder => builder.addMatcher(isRequestAction, state => {\n    state.fetching = true;\n  }).addMatcher(isResponseAction, state => {\n    state.fetching = false;\n  })\n});\nexport const preliquidationSelector = state => state.preliquidations;\nexport const actions = preliquidationSlice.actions;\nexport const allPreliquidationsSelected = createSelector(state => state.preliquidations, preli => preli.preliquidationsSelected.length > 0 && preli.preliquidations.filter(p => {\n  var _p$status3, _p$status4;\n\n  return ((_p$status3 = p.status) === null || _p$status3 === void 0 ? void 0 : _p$status3.tag) === \"approved\" || ((_p$status4 = p.status) === null || _p$status4 === void 0 ? void 0 : _p$status4.tag) === \"pending_accounting\";\n}).length === preli.preliquidationsSelected.length);\nexport const existApprovedPreliquidation = createSelector(state => state.preliquidations, preli => preli.preliquidations.some(p => {\n  var _p$status5, _p$status6;\n\n  return ((_p$status5 = p.status) === null || _p$status5 === void 0 ? void 0 : _p$status5.tag) === \"approved\" || ((_p$status6 = p.status) === null || _p$status6 === void 0 ? void 0 : _p$status6.tag) === \"pending_accounting\";\n}));\nexport default preliquidationSlice.reducer;","map":{"version":3,"sources":["/home/nahuel/pickers-admin-front/src/reducers/preliquidation.ts"],"names":["createSlice","createSelector","LoadingButtonState","endsWithAny","initialState","fetching","invoiceFileStatus","error","loading","message","adjustingAmount","Idle","approvingInvoice","showEditPreliquidationModal","preliquidations","dirty","preliquidationsSelected","filters","filtersExtra","limit","offset","seeMore","filtersExtraSeeMore","invoiceTypes","detailPreliquidations","id","status","description","tag","generatedAt","fiscalNumber","companyName","sapCode","total","manualCorrection","maxAllowedPlus","maxAllowedSubtract","histories","transactions","quantity","items","invoiceDetail","emisionDate","invoiceNumber","salePoint","invoiceType","name","caeNumber","fiscalData","taxPayerType","invoiceFile","upload","url","presettementId","undefined","actualPage","SLICE_NAME","isRequestAction","action","type","startsWith","endsWith","isResponseAction","preliquidationSlice","reducers","reset","state","getPreliquidationsRequest","getMorePreliquidationsRequest","getPreliquidationsSuccess","payload","result","hasMore","getMorePreliquidationsSuccess","getPreliquidationsError","getMorePreliquidationsError","setPreliquidationFilters","setPreliquidationExtraFilters","getInvoiceDetailRequest","getInvoiceDetailError","getInvoiceDetailSuccess","presettlement","invoice","getInvoiceDetailSaveRequest","getInvoiceDetailSaveError","getInvoiceDetailSaveSuccess","getInvoiceDetailApproveFetch","Loading","getInvoiceDetailApproveError","Error","getInvoiceDetailApproveSuccess","Success","getInvoiceDetailDeleteRequest","getInvoiceDetailDeleteError","getInvoiceDetailDeleteSuccess","replaceInvoiceFile","replaceInvoiceFileError","uploadInvoiceFile","uploadInvoiceFileError","uploadInvoiceFileSuccess","deleteInvoiceFileRequest","deleteInvoiceFileError","deleteInvoiceFileSuccess","sendAccountingRequest","sendAccountingError","sendAccountingSuccess","toggleModalVisibility","getInvoiceDetailTypesRequest","getInvoiceDetailTypesError","getInvoiceDetailTypesSuccess","adjustAmount","adjustAmountError","adjustAmountSuccess","getDetailPreliquidationsRequest","getDetailPreliquidationsError","getDetailPreliquidationsSuccess","setDirty","setInvoiceFileStatus","setActualPage","resetAllSelected","resetInvoiceDetail","toggleItem","item","idx","findIndex","p","splice","push","toggleAll","approvedItems","filter","length","extraReducers","builder","addMatcher","preliquidationSelector","actions","allPreliquidationsSelected","preli","existApprovedPreliquidation","some","reducer"],"mappings":"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","sourcesContent":["import {\n  Action,\n  createSlice,\n  PayloadAction,\n  createSelector,\n} from \"@reduxjs/toolkit\";\nimport { LoadingButtonState } from \"component/loadingButton/types\";\nimport { detailPreliquidationDatePicker } from \"pages/preliquidation/DetailPreliquidation/invoice/types\";\nimport { PagesPreliquidationTypes } from \"pages/preliquidation/DetailPreliquidation/types\";\nimport {\n  PreliquidationFilterExtraType,\n  PreliquidationFiltersType,\n} from \"pages/preliquidation/filter/types\";\nimport {\n  DetailPreliquidationsContentResponseType,\n  InvoiceTypes,\n  PreliquidationItem,\n  PreliquidationParamsMiddlewareType,\n  PreliquidationsContentResponseType,\n  AdjustAmountMiddlewareType,\n  RejectInvoiceMiddlewareType,\n  sendAccountinMiddlewareType,\n} from \"sagas/types/preliquidation\";\nimport { RootState } from \"store\";\nimport { endsWithAny } from \"utils/endsWithAny\";\nimport {\n  InvoiceFileStatus,\n  PreliquidationsSuccessMoreResponseType,\n  PreliquitadionStateType,\n} from \"./types/preliquidation\";\n\nexport const initialState: PreliquitadionStateType = {\n  fetching: false,\n  invoiceFileStatus: {\n    error: false,\n    loading: false,\n    message: \"\",\n  },\n  adjustingAmount: LoadingButtonState.Idle,\n  approvingInvoice: LoadingButtonState.Idle,\n  showEditPreliquidationModal: false,\n  preliquidations: [],\n  dirty: false,\n  preliquidationsSelected: [],\n  filters: {},\n  filtersExtra: {\n    limit: 3,\n    offset: 0,\n  },\n  seeMore: true,\n  filtersExtraSeeMore: {\n    limit: 15,\n    offset: 0,\n  },\n  invoiceTypes: [],\n  detailPreliquidations: {\n    id: 0,\n    status: {\n      id: 0,\n      description: \"\",\n      tag: \"\",\n    },\n    generatedAt: \"\",\n    fiscalNumber: \"\",\n    companyName: \"\",\n    sapCode: \"\",\n    total: 0.0,\n    manualCorrection: {\n      maxAllowedPlus: 0.0,\n      maxAllowedSubtract: 0.0,\n    },\n    histories: [],\n    transactions: {\n      quantity: 0,\n      items: [],\n    },\n  },\n  invoiceDetail: {\n    id: 0,\n    emisionDate: \"\",\n    invoiceNumber: \"\",\n    salePoint: \"\",\n    invoiceType: {\n      name: \"\",\n      tag: \"\",\n    },\n    caeNumber: \"\",\n    fiscalData: {\n      fiscalNumber: \"\",\n      companyName: \"\",\n      taxPayerType: \"\",\n      total: 0,\n    },\n    invoiceFile: {\n      upload: false,\n      url: null,\n    },\n    presettementId: undefined,\n  },\n  actualPage: \"preliquidation\",\n};\n\nconst SLICE_NAME = \"preliquidation\";\n\nconst isRequestAction = (action: Action<string>) => {\n  const { type } = action;\n  return type.startsWith(SLICE_NAME) && type.endsWith(\"Request\");\n};\n\nconst isResponseAction = (action: Action<string>) => {\n  const { type } = action;\n  return type.startsWith(SLICE_NAME) && endsWithAny(type, [\"Error\", \"Success\"]);\n};\n\nexport const preliquidationSlice = createSlice({\n  name: SLICE_NAME,\n  initialState,\n  reducers: {\n    reset: (state: PreliquitadionStateType) => {\n      state = {\n        ...initialState,\n      };\n    },\n    getPreliquidationsRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationParamsMiddlewareType>\n    ) => { },\n    getMorePreliquidationsRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationParamsMiddlewareType>\n    ) => { },\n    getPreliquidationsSuccess: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationsContentResponseType>\n    ) => {\n      const { payload } = action;\n\n      state.preliquidations = payload.result.items;\n      state.seeMore = payload.hasMore;\n      state.filtersExtraSeeMore.offset = payload.offset + payload.limit;\n    },\n    getMorePreliquidationsSuccess: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationsSuccessMoreResponseType>\n    ) => {\n      const { payload } = action;\n      state.preliquidations = [...state.preliquidations, ...payload.items];\n      state.seeMore = payload.hasMore;\n      state.filtersExtraSeeMore.offset = payload.offset + payload.limit;\n    },\n    getPreliquidationsError: () => { },\n    getMorePreliquidationsError: () => { },\n    setPreliquidationFilters: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationFiltersType>\n    ) => {\n      state.filters = action.payload;\n    },\n    setPreliquidationExtraFilters: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationFilterExtraType>\n    ) => {\n      state.filtersExtra = { ...state.filtersExtra, ...action.payload };\n    },\n\n    getInvoiceDetailRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<string | undefined>\n    ) => { },\n    getInvoiceDetailError: () => { },\n    getInvoiceDetailSuccess: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<DetailPreliquidationsContentResponseType>\n    ) => {\n      const { payload } = action;\n      const { presettlement, ...invoice } = payload;\n      state.invoiceDetail = invoice;\n      state.detailPreliquidations = {\n        ...state.detailPreliquidations,\n        ...presettlement,\n      };\n    },\n    getInvoiceDetailSaveRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<detailPreliquidationDatePicker>\n    ) => { },\n    getInvoiceDetailSaveError: () => { },\n    getInvoiceDetailSaveSuccess: () => { },\n    getInvoiceDetailApproveFetch: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<detailPreliquidationDatePicker>\n    ) => {\n      state.approvingInvoice = LoadingButtonState.Loading;\n    },\n    getInvoiceDetailApproveError: (state: PreliquitadionStateType) => {\n      state.approvingInvoice = LoadingButtonState.Error;\n    },\n    getInvoiceDetailApproveSuccess: (state: PreliquitadionStateType) => {\n      state.approvingInvoice = LoadingButtonState.Success;\n    },\n    getInvoiceDetailDeleteRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<RejectInvoiceMiddlewareType>\n    ) => { },\n    getInvoiceDetailDeleteError: () => { },\n    getInvoiceDetailDeleteSuccess: () => { },\n    replaceInvoiceFile: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<{ id: number; content: string }>\n    ) => { },\n    replaceInvoiceFileError: (state: PreliquitadionStateType) => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: true,\n        message: \"component:label.pdfController.serverError\",\n      };\n    },\n    uploadInvoiceFile: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<{ id: number; content: string }>\n    ) => { },\n    uploadInvoiceFileError: (state: PreliquitadionStateType) => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: true,\n        message: \"component:label.pdfController.serverError\",\n      };\n    },\n    uploadInvoiceFileSuccess: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<string>\n    ) => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: false,\n        message: \"\",\n      };\n      state.invoiceDetail.invoiceFile = {\n        upload: true,\n        url: action.payload,\n      };\n    },\n    deleteInvoiceFileRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<{ id: number }>\n    ) => { },\n    deleteInvoiceFileError: (state: PreliquitadionStateType) => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: true,\n        message: \"component:label.pdfController.serverError\",\n      };\n    },\n    deleteInvoiceFileSuccess: (state: PreliquitadionStateType) => {\n      state.invoiceFileStatus = {\n        loading: false,\n        error: false,\n        message: \"\",\n      };\n      state.invoiceDetail.invoiceFile = {\n        upload: false,\n        url: null,\n      };\n    },\n\n    sendAccountingRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<sendAccountinMiddlewareType>\n    ) => { },\n    sendAccountingError: () => { },\n    sendAccountingSuccess: (state: PreliquitadionStateType) => {\n      state.preliquidationsSelected = [];\n      state.filters = initialState.filters;\n      state.filtersExtra = initialState.filtersExtra;\n      state.filtersExtraSeeMore = initialState.filtersExtraSeeMore;\n    },\n\n    toggleModalVisibility: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<boolean>\n    ) => {\n      state.showEditPreliquidationModal = action.payload;\n    },\n    getInvoiceDetailTypesRequest: () => { },\n    getInvoiceDetailTypesError: () => { },\n    getInvoiceDetailTypesSuccess: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<InvoiceTypes[]>\n    ) => {\n      const { payload } = action;\n      state.invoiceTypes = payload;\n    },\n    adjustAmount: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<AdjustAmountMiddlewareType>\n    ) => {\n      state.adjustingAmount = LoadingButtonState.Loading;\n    },\n    adjustAmountError: (state: PreliquitadionStateType) => {\n      state.adjustingAmount = LoadingButtonState.Error;\n    },\n    adjustAmountSuccess: (state: PreliquitadionStateType) => {\n      state.adjustingAmount = LoadingButtonState.Success;\n    },\n    getDetailPreliquidationsRequest: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<number>\n    ) => {\n      state.adjustingAmount = LoadingButtonState.Idle;\n    },\n    getDetailPreliquidationsError: () => { },\n    getDetailPreliquidationsSuccess: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<any>\n    ) => {\n      state.detailPreliquidations = action.payload;\n    },\n    setDirty: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<boolean>\n    ) => {\n      state.dirty = action.payload;\n    },\n    setInvoiceFileStatus: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<InvoiceFileStatus>\n    ) => {\n      state.invoiceFileStatus = {\n        ...state.invoiceFileStatus,\n        ...action.payload,\n      };\n    },\n    setActualPage: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PagesPreliquidationTypes>\n    ) => {\n      state.actualPage = action.payload;\n    },\n    resetAllSelected: (\n      state: PreliquitadionStateType,\n      action: PayloadAction\n    ) => {\n      state.preliquidationsSelected = [];\n    },\n    resetInvoiceDetail: (state: PreliquitadionStateType) => {\n      state.invoiceDetail = initialState.invoiceDetail;\n    },\n    toggleItem: (\n      state: PreliquitadionStateType,\n      action: PayloadAction<PreliquidationItem>\n    ) => {\n      const item = action.payload;\n      const idx = state.preliquidationsSelected.findIndex(\n        (p) => p.id === item.id\n      );\n\n      if (idx >= 0) state.preliquidationsSelected.splice(idx, 1);\n      else state.preliquidationsSelected.push(item);\n    },\n    toggleAll: (state: PreliquitadionStateType) => {\n      const approvedItems = state.preliquidations.filter(\n        (p) =>  p.status?.tag === \"approved\" || p.status?.tag === \"pending_accounting\"\n      );\n      // Estan todas las preli seleccionadas\n      if (approvedItems.length === state.preliquidationsSelected.length)\n        state.preliquidationsSelected = [];\n      else state.preliquidationsSelected = approvedItems;\n    },\n  },\n  extraReducers: (builder) =>\n    builder\n      .addMatcher(isRequestAction, (state: PreliquitadionStateType) => {\n        state.fetching = true;\n      })\n      .addMatcher(isResponseAction, (state: PreliquitadionStateType) => {\n        state.fetching = false;\n      }),\n});\n\nexport const preliquidationSelector = (state: RootState) =>\n  state.preliquidations;\n\nexport const actions = preliquidationSlice.actions;\n\nexport const allPreliquidationsSelected = createSelector(\n  (state: RootState) => state.preliquidations,\n  (preli) =>\n    preli.preliquidationsSelected.length > 0 &&\n    preli.preliquidations.filter((p) => p.status?.tag === \"approved\" || p.status?.tag === \"pending_accounting\").length ===\n    preli.preliquidationsSelected.length\n);\nexport const existApprovedPreliquidation = createSelector(\n  (state: RootState) => state.preliquidations,\n  (preli) => preli.preliquidations.some((p) => p.status?.tag === \"approved\" || p.status?.tag === \"pending_accounting\")\n);\n\nexport default preliquidationSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}